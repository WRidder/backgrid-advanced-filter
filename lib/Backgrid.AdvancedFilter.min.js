!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("Backgrid"),require("_"),require("Backbone"),require("jQuery")):"function"==typeof define&&define.amd?define(["Backgrid","_","Backbone","jQuery"],t):"object"==typeof exports?exports["Backgrid.Extension.AdvancedFilter"]=t(require("Backgrid"),require("_"),require("Backbone"),require("jQuery")):e["Backgrid.Extension.AdvancedFilter"]=t(e.Backgrid,e._,e.Backbone,e.jQuery)}(this,function(e,t,i,l){return function(e){function t(l){if(i[l])return i[l].exports;var n=i[l]={exports:{},id:l,loaded:!1};return e[l].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){"use strict";var l=i(1);l.Extension.AdvancedFilter={SubComponents:{}},i(10),i(11),i(9),i(5),i(7),i(12),i(6),i(13),i(8)},function(t,i){t.exports=e},function(e,i){e.exports=t},function(e,t){e.exports=i},function(e,t,i){var l,n,r;/*
	  backgrid-filter
	  http://github.com/wyuenho/backgrid

	  Copyright (c) 2013 Jimmy Yuen Ho Wong and contributors
	  Licensed under the MIT @license.
	*/
!function(o,a){n=[i(2),i(3),i(1)],l=a,r="function"==typeof l?l.apply(t,n):l,!(void 0!==r&&(e.exports=r))}(this,function(e,t,i,l){"use strict";var n=i.Extension.ServerSideFilter=t.View.extend({tagName:"form",className:"backgrid-filter form-search",template:function(e){return'<span class="search">&nbsp;</span><input type="search" '+(e.placeholder?'placeholder="'+e.placeholder+'"':"")+' name="'+e.name+'" '+(e.value?'value="'+e.value+'"':"")+'/><a class="clear" data-backgrid-action="clear" href="#">&times;</a>'},events:{"keyup input[type=search]":"showClearButtonMaybe","click a[data-backgrid-action=clear]":"clear",submit:"search"},name:"q",value:null,placeholder:null,initialize:function(e){n.__super__.initialize.apply(this,arguments),this.name=e.name||this.name,this.value=e.value||this.value,this.placeholder=e.placeholder||this.placeholder,this.template=e.template||this.template;var i=this.collection,l=this;t.PageableCollection&&i instanceof t.PageableCollection&&"server"==i.mode&&(i.queryParams[this.name]=function(){return l.searchBox().val()||null})},clearSearchBox:function(){this.value=null,this.searchBox().val(null),this.showClearButtonMaybe()},showClearButtonMaybe:function(){var e=this.clearButton(),t=this.searchBox().val();t?e.show():e.hide()},searchBox:function(){return this.$el.find("input[type=search]")},clearButton:function(){return this.$el.find("a[data-backgrid-action=clear]")},query:function(){return this.value=this.searchBox().val(),this.value},search:function(e){e&&e.preventDefault();var i={},l=this.query();l&&(i[this.name]=l);var n=this.collection;t.PageableCollection&&n instanceof t.PageableCollection?n.getFirstPage({data:i,reset:!0,fetch:!0}):n.fetch({data:i,reset:!0})},clear:function(e){e&&e.preventDefault(),this.clearSearchBox();var i=this.collection;t.PageableCollection&&i instanceof t.PageableCollection?i.getFirstPage({reset:!0,fetch:!0}):i.fetch({reset:!0})},render:function(){return this.$el.empty().append(this.template({name:this.name,placeholder:this.placeholder,value:this.value})),this.showClearButtonMaybe(),this.delegateEvents(),this}}),r=i.Extension.ClientSideFilter=n.extend({events:e.extend({},n.prototype.events,{"click a[data-backgrid-action=clear]":function(e){e.preventDefault(),this.clear()},"keydown input[type=search]":"search",submit:function(e){e.preventDefault(),this.search()}}),fields:null,wait:149,initialize:function(t){r.__super__.initialize.apply(this,arguments),this.fields=t.fields||this.fields,this.wait=t.wait||this.wait,this._debounceMethods(["search","clear"]);var i=this.collection=this.collection.fullCollection||this.collection,l=this.shadowCollection=i.clone();this.listenTo(i,"add",function(e,t,i){l.add(e,i)}),this.listenTo(i,"remove",function(e,t,i){l.remove(e,i)}),this.listenTo(i,"sort",function(e){this.searchBox().val()||l.reset(e.models)}),this.listenTo(i,"reset",function(t,i){i=e.extend({reindex:!0},i||{}),i.reindex&&null==i.from&&null==i.to&&l.reset(t.models)})},_debounceMethods:function(t){e.isString(t)&&(t=[t]),this.undelegateEvents();for(var i=0,l=t.length;l>i;i++){var n=t[i],r=this[n];this[n]=e.debounce(r,this.wait)}this.delegateEvents()},makeRegExp:function(e){return new RegExp(e.trim().split(/\s+/).join("|"),"i")},makeMatcher:function(e){var t=this.makeRegExp(e);return function(e){for(var i=this.fields||e.keys(),l=0,n=i.length;n>l;l++)if(t.test(e.get(i[l])+""))return!0;return!1}},search:function(){var t=e.bind(this.makeMatcher(this.query()),this),i=this.collection;i.pageableCollection&&i.pageableCollection.getFirstPage({silent:!0}),i.reset(this.shadowCollection.filter(t),{reindex:!1})},clear:function(){this.clearSearchBox();var e=this.collection;e.pageableCollection&&e.pageableCollection.getFirstPage({silent:!0}),e.reset(this.shadowCollection.models,{reindex:!1})}}),o=i.Extension.LunrFilter=r.extend({ref:"id",fields:null,initialize:function(e){o.__super__.initialize.apply(this,arguments),this.ref=e.ref||this.ref;var t=this.collection=this.collection.fullCollection||this.collection;this.listenTo(t,"add",this.addToIndex),this.listenTo(t,"remove",this.removeFromIndex),this.listenTo(t,"reset",this.resetIndex),this.listenTo(t,"change",this.updateIndex),this.resetIndex(t)},resetIndex:function(t,i){if(i=e.extend({reindex:!0},i||{}),i.reindex){var n=this;this.index=l(function(){e.each(n.fields,function(e,t){this.field(t,e),this.ref(n.ref)},this)}),t.each(function(e){this.addToIndex(e)},this)}},addToIndex:function(e){var t=this.index,i=e.toJSON();t.documentStore.has(i[this.ref])?t.update(i):t.add(i)},removeFromIndex:function(e){var t=this.index,i=e.toJSON();t.documentStore.has(i[this.ref])&&t.remove(i)},updateIndex:function(t){var i=t.changedAttributes();i&&!e.isEmpty(e.intersection(e.keys(this.fields),e.keys(i)))&&this.index.update(t.toJSON())},search:function(){var e=this.collection;if(!this.query())return void e.reset(this.shadowCollection.models,{reindex:!1});for(var t=this.index.search(this.query()),i=[],l=0;l<t.length;l++){var n=t[l];i.push(this.shadowCollection.get(n.ref))}e.pageableCollection&&e.pageableCollection.getFirstPage({silent:!0}),e.reset(i,{reindex:!1})}})})},function(e,t,i){"use strict";var l=i(3),n=i(1),r=i(2),o=n.Extension.AdvancedFilter.FilterOptions.Matchers,a=n.Extension.AdvancedFilter.FilterOptions.Types,s=n.Extension.AdvancedFilter.FilterOptions.MatchersValueTypeValidator,d=n.Extension.AdvancedFilter.AttributeFilterModel=l.Model.extend({defaults:{column:null,type:null,matcher:"eq",value:null,valid:!1},initialize:function(){var e=this;e.listenTo(e,"change:column change:type change:matcher change:value",e.setValidity),e.listenTo(e,"change:column",e.columnChange),e.listenTo(e,"change:matcher",e.matcherChange)},validator:function(){var e=this,t=!1,i=e.get("type"),l=e.get("matcher"),n=e.get("value");if(r.has(a,i)&&r.contains(a[i].matchers,l)){var d=o[l].valueType;if(s[d](n))if(r.isArray(n)){var c=!0;r.each(n,function(e){c=c&&a[i].validator(e)}),t=c}else t=a[i].validator(n)}return t},setValidity:function(){var e=this;e.set("valid",e.validator())},columnChange:function(){var e=this;e.validator()||e.set("matcher",null)},matcherChange:function(){var e=this;e.validator()||e.set("value",null)}});n.Extension.AdvancedFilter.AttributeFilterCollection=l.Collection.extend({model:d,createNewAttributeFilter:function(){var e=this;e.add({})}});var c=n.Extension.AdvancedFilter.FilterModel=l.Model.extend({defaults:{name:null,attributeFilters:null},lastSavedState:null,filterChanged:!1,initialize:function(){var e=this;e.saveState(),e.listenTo(e.get("attributeFilters"),"change add remove",e.evtFilterChanged),e.listenTo(e,"change:name",e.evtFilterChanged)},evtFilterChanged:function(){var e=this;e.filterChanged=!0,e.trigger("filter:changed")},saveFilter:function(){var e=this;e.saveState()},resetFilter:function(){var e=this;e.get("attributeFilters").reset([])},cancelFilter:function(){var e=this;e.loadSavedState()},saveState:function(){var e=this,t=e.get("name"),i=e.get("attributeFilters");i=i&&i.length>0?i.toJSON():null,e.lastSavedState={name:t,attributeFilters:i},e.filterChanged=!1},loadSavedState:function(){var e=this;e.lastSavedState&&(e.set("name",e.lastSavedState.name),e.get("attributeFilters").reset(e.lastSavedState.attributeFilters))},removeSavedState:function(){var e=this;e.lastSavedState=null},set:function(e,t){var i=n.Extension.AdvancedFilter.AttributeFilterCollection;return void 0===e.attributeFilters||e.attributeFilters instanceof i||(e.attributeFilters=new i(e.attributeFilters)),l.Model.prototype.set.call(this,e,t)},exportFilter:function(e,t){var i,l=this;switch(e){case"mongo":case"mongodb":default:var r=new n.Extension.AdvancedFilter.FilterParsers.MongoParser;i=r.parse(l),t&&(i=l.stringifyFilterJson(i))}return i},stringifyFilterJson:function(e,t){var i;switch(t){case"mongo":case"mongodb":default:i=JSON.stringify(e)}return i}});n.Extension.AdvancedFilter.FilterCollection=l.Collection.extend({filterNamePartial:"{count}",newFilterName:"New Filter #{count}",newFilterCount:0,model:c,createNewFilter:function(){var e=this,t=new c({name:e.getNewFilterName(e.getNewFilterNumber())});return e.add(t),t},getNewFilterNumber:function(){var e=this;if(e.newFilterCount+=1,0===e.length)return e.newFilterCount;var t=e.newFilterName.replace(e.filterNamePartial,""),i=e.filter(function(e){return 0===e.get("name").indexOf(t)}).map(function(e){return e.get("name")});if(r.isArray(i)&&i.length>0){i.sort();var l=parseInt(i[i.length-1].replace(t,""));r.isNaN(l)?l=e.newFilterCount:l+=1}else l=e.newFilterCount;return l},getNewFilterName:function(e){return this.newFilterName.replace(this.filterNamePartial,e)}})},function(e,t,i){"use strict";var l=i(2),n=i(3),r=i(1);r.Extension.AdvancedFilter.SubComponents.FilterDropdownItemview=n.View.extend({className:"advancedfilter-dropdown-item",template:l.template("<span class='indicator'></span><span class='filter-name'><%= name %></span>"),tagName:"li",events:{click:"setActiveFilter"},initialize:function(e){var t=this;t.filterStateModel=e.parentView.filterStateModel,t.filter=e.filter,l.bindAll(t,"render","setActiveFilter"),t.listenTo(t.filter,"change:name",t.render,t)},setActiveFilter:function(e){var t=this;e&&t.stopPropagation(e),t.filterStateModel.setActiveFilter(t.filter)},render:function(){var e=this;return e.$el.empty(),e.$el.append(e.template({name:e.filter.get("name")})),e.filterStateModel.get("activeFilterId")===e.filter.cid?e.$el.addClass("active"):e.$el.removeClass("active"),e},stopPropagation:function(e){e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault()}}),r.Extension.AdvancedFilter.SubComponents.FilterDropdownContainer=n.View.extend({className:"filter-dropdown-container",defaults:{DropdownItemView:r.Extension.AdvancedFilter.SubComponents.FilterDropdownItemview},initialize:function(e){var t=this;t.options=l.extend({},t.defaults,e||{}),t.parentView=t.options.parentView,t.listenTo(t.parentView.filterStateModel.get("filterCollection"),"add remove",t.render),t.listenTo(t.parentView.filterStateModel,"change:activeFilterId",t.render)},render:function(){var e=this;return e.$el.empty(),e.parentView.filterStateModel.get("filterCollection").each(function(t){e.$el.append(new e.options.DropdownItemView({filter:t,parentView:e.parentView}).render().$el)}),e},open:function(){var e=this;e.$el.addClass("open");var t,i=e.parentView.$dropdownButton;if("auto"===e.options.align){var l=document.body.clientWidth||document.body.clientWidth;t=i.offset().left+e.$el.outerWidth()>l?"left":"right"}else t="left"===e.options.align||"right"===e.options.align?"right"===e.options.align?"right":"left":"right";var n;"left"===t?(n=i.offset().left+i.outerWidth()-e.$el.outerWidth(),e.$el.css("left",n+"px")):(n=i.offset().left,e.$el.css("left",n+"px"));var r=i.offset().top+i.outerHeight();e.$el.css("top",r+"px")},close:function(){this.$el.removeClass("open")}}),r.Extension.AdvancedFilter.SubComponents.FilterDropdown=n.View.extend({tagName:"div",defaultEvents:{click:"stopPropagation"},defaults:{width:null,closeOnEsc:!0,closeOnClick:!0,openOnInit:!1,buttonTemplate:l.template("<button class='dropdown-button <%-buttonClass%>'><%=buttonText%></button>"),buttonClass:"",buttonText:"Filter &#9660;",DropdownView:r.Extension.AdvancedFilter.SubComponents.FilterDropdownContainer,dropdownAlign:"auto"},initialize:function(e){var t=this;if(t.options=l.extend({},t.defaults,e||{}),t.events=l.extend({},t.defaultEvents,t.events||{}),!t.options.filterStateModel||!t.options.filterStateModel instanceof n.Model)throw new Error("No (valid) filter state model provided");t.filterStateModel=t.options.filterStateModel,l.bindAll(t,"deferClose","stopDeferClose","closeOnEsc","toggle","render","open","close"),document.body.addEventListener("click",t.deferClose,!0),t.options.closeOnEsc&&document.body.addEventListener("keyup",t.closeOnEsc,!1),t.$el.on("click",t.stopDeferClose),t.setup(),t.listenTo(t.filterStateModel.get("filterCollection"),"add remove",t.checkDisabled)},delayStart:function(){clearTimeout(this.closeTimeout),this.delayTimeout=setTimeout(this.open,this.options.delay)},delayEnd:function(){clearTimeout(this.delayTimeout),this.closeTimeout=setTimeout(this.close,300)},setup:function(){var e=this;e.options.width&&e.$el.width(e.options.width+"px"),e.$dropdownButton=n.$(e.options.buttonTemplate({buttonClass:e.options.buttonClass,buttonText:e.options.buttonText})).click(e.toggle),e.dropdownContainerView=new e.options.DropdownView({filterStateModel:e.filterStateModel,align:e.options.dropdownAlign,parentView:e}).render(),document.body.appendChild(e.dropdownContainerView.el)},render:function(){var e=this;return e.$el.empty(),e.$el.html(e.$dropdownButton),e.checkDisabled(),e},checkDisabled:function(){var e=this;e.filterStateModel.get("filterCollection").length>0?e.$dropdownButton.removeAttr("disabled"):e.$dropdownButton.attr("disabled","disabled")},stopPropagation:function(e){e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault()},toggle:function(e){var t=this;t.isOpen!==!0?t.open(e):t.close(e)},open:function(e){var t=this;clearTimeout(t.closeTimeout),clearTimeout(t.deferCloseTimeout),e&&(e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0),t.isOpen||(t.isOpen=!0,t.$el.addClass("open"),t.dropdownContainerView.open())},close:function(e){var t=this;t.isOpen&&(t.isOpen=!1,t.$el.removeClass("open"),t.dropdownContainerView.close())},closeOnEsc:function(e){27===e.which&&this.deferClose()},deferClose:function(){this.deferCloseTimeout=setTimeout(this.close,0)},stopDeferClose:function(e){clearTimeout(this.deferCloseTimeout)},remove:function(){var e=this;return e.dropdownContainerView.remove(),document.body.removeEventListener("click",e.deferClose),e.options.closeOnEsc&&document.body.removeEventListener("keyup",e.closeOnEsc),e.$el.off("click",e.stopDeferClose),e.$dropdownButton.off("click",e.toggle),n.View.prototype.remove.apply(e,arguments)}})},function(e,t,i){"use strict";var l=i(2),n=i(14),r=i(3),o=i(1),a=r.View.extend({tagName:"button",defaults:{buttonText:"",buttonClass:""},events:{click:"clickHandler"},initialize:function(e){var t=this;if(t.options=l.extend({},t.defaults,e||{}),!t.options.filterStateModel||!t.options.filterStateModel instanceof r.Model)throw new Error("ButtonView: No (valid) filter state model provided");if(t.filterStateModel=t.options.filterStateModel,!t.options.filter||!t.options.filter instanceof r.Model)throw new Error("ButtonView: No (valid) attribute filter model provided");t.filter=t.options.filter},render:function(){var e=this;return e.$el.empty(),e.$el.addClass(e.options.buttonClass),e.$el.text(e.options.buttonText),e},clickHandler:function(e){var t=this;t.stopPropagation(e)},stopPropagation:function(e){e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault()}}),s=a.extend({defaults:{buttonText:"+",buttonClass:"new-attribute-filter"},clickHandler:function(e){var t=this;t.stopPropagation(e);var i=t.filterStateModel,l=i.getActiveFilter();l.get("attributeFilters").createNewAttributeFilter()}}),d=a.extend({defaults:{buttonText:"-",buttonClass:"remove-attribute-filter"},clickHandler:function(e){var t=this;t.stopPropagation(e);var i=t.filterStateModel,l=i.get("activeFilterId"),n=i.get("filterCollection").get(l);n.get("attributeFilters").remove(t.filter)}}),c=r.View.extend({className:"column-selector",tagName:"select",initFinished:!1,defaults:{placeHolderText:"Select column..."},events:{change:"columnUpdate"},initialize:function(e){var t=this;if(t.options=l.extend({},t.defaults,e||{}),!t.options.filterStateModel||!t.options.filterStateModel instanceof r.Model)throw new Error("ColumnSelectorView: No (valid) filter state model provided");if(t.filterStateModel=t.options.filterStateModel,!t.options.filter||!t.options.filter instanceof r.Model)throw new Error("ColumnSelectorView: No (valid) attribute filter model provided");t.filter=t.options.filter},render:function(){var e=this,t=e.filterOptions=e.filterStateModel.getFilterableColumns();return e.$el.append('<option value=""disabled selected>'+e.options.placeHolderText+"</option>"),l.each(t,function(t,i){e.$el.append(n("<option></option>").attr("value",i).text(t.label))}),l.has(t,e.filter.get("column"))&&e.$el.val(e.filter.get("column")),e.initFinished=!0,e},columnUpdate:function(){var e=this;if(e.initFinished){var t=e.$el.val(),i=e.filterOptions[t].filterType;e.filter.set({column:t,type:i})}}}),u=r.View.extend({tagName:"select",events:{change:"matcherUpdate"},defaults:{placeHolderText:"select a method..."},initialize:function(e){var t=this;if(t.options=l.extend({},t.defaults,e||{}),!t.options.filterStateModel||!t.options.filterStateModel instanceof r.Model)throw new Error("ColumnSelectorView: No (valid) filter state model provided");if(t.filterStateModel=t.options.filterStateModel,!t.options.filter||!t.options.filter instanceof r.Model)throw new Error("ColumnSelectorView: No (valid) attribute filter model provided");t.filter=t.options.filter},render:function(){var e=this,t=e.filterOptions=e.filterStateModel.getMatchers(e.filter.get("type"));return e.$el.append('<option value=""disabled selected>'+e.options.placeHolderText+"</option>"),l.each(t,function(t,i){e.$el.append(n("<option></option>").attr("value",i).text(t.label))}),l.has(t,e.filter.get("matcher"))&&e.$el.val(e.filter.get("matcher")),e},matcherUpdate:function(){var e=this;e.filter.set("matcher",e.$el.val())}}),f=r.View.extend({className:"single-value-bool",tagName:"select",events:{change:"valueUpdate"},defaults:{placeHolderText:"select true or false"},initialize:function(e){var t=this;if(t.options=l.extend({},t.defaults,e||{}),!t.options.filter||!t.options.filter instanceof r.Model)throw new Error("No (valid) filter state model provided");t.filter=t.options.filter},render:function(){var e=this;e.$el.empty(),e.$el.append('<option value=""disabled selected>'+e.options.placeHolderText+"</option>"),e.$el.append(n("<option></option>").attr("value",!0).text("true")),e.$el.append(n("<option></option>").attr("value",!1).text("false"));var t=e.filter.get("value");return(t===!0||t===!1)&&e.$el.val(t),e},valueUpdate:function(){var e=this;e.filter.set("value",e.$el.val())}}),p=r.View.extend({className:"single-value-text",tagName:"input",events:{change:"valueUpdate"},initialize:function(e){var t=this;if(t.options=l.extend({},t.defaults,e||{}),!t.options.filter||!t.options.filter instanceof r.Model)throw new Error("No (valid) filter state model provided");t.filter=t.options.filter},render:function(){var e=this;return e.$el.empty(),e.$el.val(e.filter.get("value")),e},valueUpdate:function(){var e=this;e.filter.set("value",e.$el.val())}}),v=r.View.extend({className:"double-value-text-container",tagName:"div",template:l.template('<input class="double-value-text"/><input class="double-value-text"/>'),events:{change:"valueUpdate"},initialize:function(e){var t=this;if(t.options=l.extend({},t.defaults,e||{}),!t.options.filterStateModel||!t.options.filterStateModel instanceof r.Model)throw new Error("MatcherSelectorView: No (valid) filter state model provided");if(t.filterStateModel=t.options.filterStateModel,!t.options.filter||!t.options.filter instanceof r.Model)throw new Error("No (valid) filter state model provided");t.filter=t.options.filter,t.valueParser=t.filterStateModel.getValueParser(t.filter.get("type"))},render:function(){var e=this;e.$el.empty(),e.$el.append(e.template());var t=e.filter.get("value");return l.isArray(t)&&2===t.length&&(e.$el.find("input").first().val(t[0]),e.$el.find("input").last().val(t[1])),e.$el.val(e.filter.get("value")),e},valueUpdate:function(){var e=this,t=[e.valueParser(e.$el.find("input").first().val()),e.valueParser(e.$el.find("input").last().val())];e.filter.set("value",t)}}),h=r.View.extend({className:"value-container",tagName:"div",defaults:{SingleValueTextView:p,DoubleValueTextView:v,SingleValueBoolView:f},initialize:function(e){var t=this;if(t.options=l.extend({},t.defaults,e||{}),t.childView=null,!t.options.filterStateModel||!t.options.filterStateModel instanceof r.Model)throw new Error("MatcherSelectorView: No (valid) filter state model provided");if(t.filterStateModel=t.options.filterStateModel,!t.options.filter||!t.options.filter instanceof r.Model)throw new Error("No (valid) filter state model provided");t.filter=t.options.filter,t.listenTo(t.filter,"change:matcher",t.render)},render:function(){var e=this;if(e.childView&&(e.childView.remove(),e.childView=null),e.filter.get("matcher")&&e.filter.get("type")){var t=e.filterStateModel.getInputTypeInfoForMatcher(e.filter.get("matcher"),e.filter.get("type"));"single"===t.valueType&&"textbox"===t.inputType&&(e.childView=new e.options.SingleValueTextView({filter:e.filter,filterStateModel:e.filterStateModel}),e.$el.append(e.childView.render().$el)),"array2"===t.valueType&&"textbox"===t.inputType&&(e.childView=new e.options.DoubleValueTextView({filter:e.filter,filterStateModel:e.filterStateModel}),e.$el.append(e.childView.render().$el)),"single"===t.valueType&&"boolean-select"===t.inputType&&(e.childView=new e.options.SingleValueBoolView({filter:e.filter,filterStateModel:e.filterStateModel}),e.$el.append(e.childView.render().$el))}return e},remove:function(){var e=this;return e.childView&&e.childView.remove(),r.View.prototype.remove.apply(e,arguments)}}),m=r.View.extend({className:"matcher-container",tagName:"div",template:l.template('<div class="matcher-selector"></div><div class="matcher-value"></div><div class="clearer"></div>'),defaults:{MatcherSelectorView:u,ValueContainerView:h},initialize:function(e){var t=this;if(t.options=l.extend({},t.defaults,e||{}),t.childViews={},!t.options.filterStateModel||!t.options.filterStateModel instanceof r.Model)throw new Error("MatcherSelectorView: No (valid) filter state model provided");if(t.filterStateModel=t.options.filterStateModel,!t.options.filter||!t.options.filter instanceof r.Model)throw new Error("No (valid) filter state model provided");t.filter=t.options.filter,t.listenTo(t.filter,"change:column",t.render),t.listenTo(t.filter,"change:matcher",t.renderValueView)},render:function(){var e=this;return e.$el.empty(),e.$el.append(e.template()),e.renderSubComponent(".matcher-selector",e.options.MatcherSelectorView),e.renderValueView(),e},renderValueView:function(){var e=this;e.filter.get("matcher")&&e.renderSubComponent(".matcher-value",e.options.ValueContainerView)},renderSubComponent:function(e,t){var i=this,l=i.$el.find("> div"+e);i.childViews[e]&&i.childViews[e].remove(),i.childViews[e]=new t({filterStateModel:i.filterStateModel,filter:i.filter}),l.append(i.childViews[e].render().$el)},remove:function(){var e=this;return l.each(e.childViews,function(e){e.remove()}),r.View.prototype.remove.apply(e,arguments)}}),g=r.View.extend({className:"columnfilter",tagName:"div",template:l.template('<div class="columnfilter-column"></div><div class="columnfilter-matcher"></div><div class="clearer"></div>'),events:{change:"columnUpdate"},defaults:{ColumnSelectorView:c,MatcherContainerView:m},initialize:function(e){var t=this;if(t.options=l.extend({},t.defaults,e||{}),t.childViews={},!t.options.filterStateModel||!t.options.filterStateModel instanceof r.Model)throw new Error("ColumnFilter: No (valid) filter state model provided");if(t.filterStateModel=t.options.filterStateModel,!t.options.filter||!t.options.filter instanceof r.Model)throw new Error("ColumnFilter: No (valid) filter model provided");t.filter=t.options.filter,t.listenTo(t.filter,"change:column",t.renderSubComponents)},render:function(){var e=this;return e.$el.empty(),e.$el.append(e.template()),e.renderSubComponents(),e},renderSubComponents:function(){var e=this;e.colSelectorRendered||(e.renderSubComponent(".columnfilter-column",e.options.ColumnSelectorView),e.colSelectorRendered=!0),!e.matcherRendered&&e.filter.get("type")&&(e.renderSubComponent(".columnfilter-matcher",e.options.MatcherContainerView),e.matcherRendered=!0)},renderSubComponent:function(e,t){var i=this,l=i.$el.find("> div"+e);l.empty();var n=new t({filter:i.filter,filterStateModel:i.filterStateModel});l.append(n.render().$el),i.childViews[e]=n},remove:function(){var e=this;return l.each(e.childViews,function(e){e.remove()}),r.View.prototype.remove.apply(e,arguments)}});o.Extension.AdvancedFilter.SubComponents.FilterView=r.View.extend({className:"filter-editor",tagName:"div",template:l.template('<div class="filter-editor-columnfilter"></div><div class="filter-editor-addremove"></div><div class="clearer"></div>'),defaults:{ColumnFilterView:g,NewFilterButtonView:s,RemoveFilterButtonView:d},initialize:function(e){var t=this;if(t.options=l.extend({},t.defaults,e||{}),!t.options.filterStateModel||!t.options.filterStateModel instanceof r.Model)throw new Error("No (valid) filter state model provided");if(t.filterStateModel=t.options.filterStateModel,!t.options.attributeFilter||!t.options.attributeFilter instanceof r.Model)throw new Error("No (valid) filter state model provided");t.filter=t.options.attributeFilter,t.listenTo(t.filter,"change:valid",t.setValidClass)},render:function(){var e=this;e.$el.empty(),e.$el.append(e.template());var t=e.columnFilterView=new this.options.ColumnFilterView({filterStateModel:e.filterStateModel,filter:e.filter});e.$el.find(".filter-editor-columnfilter").append(t.render().$el);var i=e.addAttributeFilterView=new this.options.NewFilterButtonView({filterStateModel:e.filterStateModel,filter:e.filter});e.$el.find(".filter-editor-addremove").append(i.render().$el);var l=e.removeAttributeFilterView=new this.options.RemoveFilterButtonView({filterStateModel:e.filterStateModel,filter:e.filter});return e.$el.find(".filter-editor-addremove").append(l.render().$el),e.setValidClass(),e},setValidClass:function(){var e=this;e.filter.get("valid")?(e.$el.removeClass("invalidvalid"),e.$el.addClass("valid")):(e.$el.removeClass("valid"),e.$el.addClass("invalid"))},remove:function(){var e=this;return e.columnFilterView.remove(),e.addAttributeFilterView.remove(),e.removeAttributeFilterView.remove(),r.View.prototype.remove.apply(e,arguments)}}),o.Extension.AdvancedFilter.Editor=r.View.extend({className:"advancedfilter-editor",tagName:"div",defaults:{NewFilterButtonView:s},initialize:function(e){var t=this;if(t.options=l.extend({},t.defaults,e||{}),!t.options.filterStateModel||!t.options.filterStateModel instanceof r.Model)throw new Error("No (valid) filter state model provided");t.filterStateModel=t.options.filterStateModel,t.listenTo(t.filterStateModel,"change:activeFilterId",t.bindFilter),t.bindFilter()},bindFilter:function(){var e=this,t=e.filterStateModel,i=t.get("activeFilterId");e.activeFilter&&t.get("filterCollection").contains(e.activeFilter)&&e.stopListening(e.activeFilter.get("attributeFilters")),i?(e.activeFilter=t.get("filterCollection").get(i),e.listenTo(e.activeFilter.get("attributeFilters"),"add remove reset",e.render)):e.activeFilter=null,e.render()},render:function(){var e=this;if(e.$el.empty(),e.activeFilter){var t=e.activeFilter;if(t.get("attributeFilters").length>0)t.get("attributeFilters").each(function(t){var i=e.childView=new o.Extension.AdvancedFilter.SubComponents.FilterView({filterStateModel:e.filterStateModel,attributeFilter:t});e.$el.append(i.render().$el)});else{var i=new e.options.NewFilterButtonView({filterStateModel:e.filterStateModel,filter:e.activeFilter});e.$el.append(i.render().$el)}}return e},remove:function(){var e=this;return e.childView&&e.childView.remove(),r.View.prototype.remove.apply(e,arguments)}})},function(e,t,i){"use strict";var l=i(2),n=i(3),r=i(1);r.Extension.AdvancedFilter.Main=n.View.extend({className:"advancedfilter",defaults:{SelectorView:r.Extension.AdvancedFilter.Selector,FilterView:r.Extension.AdvancedFilter.Editor,SaverView:r.Extension.AdvancedFilter.Saver},initialize:function(e){var t=this;if(t.options=l.extend({},t.defaults,e||{}),t.components={},!t.options.collection||!t.options.collection instanceof n.Collection)throw new Error("AdvancedFilter: data collection is required.");if(!t.options.columns||!t.options.columns instanceof r.Columns)throw new Error("AdvancedFilter: columns are required.");(!t.options.filters||l.isArray(t.options.filter)&&l.isEmpty(t.options.filter))&&(t.options.filters=new r.Extension.AdvancedFilter.FilterCollection),t.createFilterStateModel(t.options)},render:function(){var e=this;e.$el.empty();var t=e.components.selector=new e.options.SelectorView({filterStateModel:e.filterStateModel});e.$el.append(t.render().$el);var i=e.components.editor=new e.options.FilterView({filterStateModel:e.filterStateModel});e.$el.append(i.render().$el);var l=e.components.saver=new e.options.SaverView({filterStateModel:e.filterStateModel});return e.$el.append(l.render().$el),e},verifyFilterId:function(e,t){return e.get(t)?!0:!1},createFilterStateModel:function(e){var t=this,i=t.verifyFilterId(e.filters,e.activeFilterId);t.filterStateModel=new r.Extension.AdvancedFilter.FilterStateModel({dataCollection:e.collection,columnCollection:e.columns,filterCollection:e.filters,activeFilterId:i?e.filters.get(e.activeFilterId).cid:null}),t.bindFilterStateEvents()},bindFilterStateEvents:function(){var e=this,t=e.filterStateModel;e.listenTo(t,"filter:new",e.evtNewFilter),e.listenTo(t,"filter:save",e.evtSaveFilter),e.listenTo(t,"filter:apply",e.evtApplyFilter),e.listenTo(t,"filter:reset",e.evtResetFilter),e.listenTo(t,"filter:cancel",e.evtCancelFilter),e.listenTo(t,"filter:remove",e.evtRemoveFilter)},evtNewFilter:function(){var e=this,t=e.filterStateModel,i=t.get("filterCollection").createNewFilter();t.set("activeFilterId",i.cid),e.trigger("filter:new",i.cid,i)},evtSaveFilter:function(){var e=this,t=e.filterStateModel,i=t.getActiveFilter();i&&(i.saveFilter(),e.trigger("filter:save",i.cid,i))},evtApplyFilter:function(){var e=this,t=e.filterStateModel,i=t.getActiveFilter();i&&e.trigger("filter:apply",i.cid,i)},evtResetFilter:function(){var e=this,t=e.filterStateModel.getActiveFilter();t.resetFilter(),e.trigger("filter:reset",t.cid,t)},evtCancelFilter:function(){var e=this,t=e.filterStateModel.getActiveFilter(),i={name:t.get("name"),attributeFilters:t.get("attributeFilters")?t.get("attributeFilters").toJSON():null};t.cancelFilter(),e.trigger("filter:cancel",t.cid,t,i)},evtRemoveFilter:function(){var e=this,t=e.filterStateModel,i=t.get("activeFilterId"),l=t.get("filterCollection").get(i),n=l.get("name");t.set("activeFilterId",null),t.get("filterCollection").remove(l),e.trigger("filter:remove",i,n)},remove:function(){var e=this;return e.components.selector.remove(),e.components.editor.remove(),e.components.saver.remove(),n.View.prototype.remove.apply(e,arguments)}})},function(e,t,i){"use strict";var l=i(2),n=i(3),r=i(1),o=r.Extension.AdvancedFilter.FilterOptions.Types,a=r.Extension.AdvancedFilter.FilterOptions.Matchers;r.Extension.AdvancedFilter.FilterStateModel=n.Model.extend({defaults:{activeFilterId:null,columnCollection:null,dataCollection:null,filterCollection:null},getActiveFilter:function(){var e=this,t=e.get("activeFilterId");return e.get("filterCollection").get(t)},setActiveFilter:function(e){var t=this;t.trigger("filter:save");var i;i=e instanceof r.Extension.AdvancedFilter.FilterModel?e.cid:e,t.get("filterCollection").get(i)&&t.set("activeFilterId",i)},getFilterableColumns:function(){var e=this,t=e.get("columnCollection");if(!t)return{};var i=t.filter(function(e){return l.has(o,e.get("filterType"))}),n={};return l.each(i,function(e){n[e.get("name")]={label:e.get("label"),filterType:e.get("filterType")}}),n},getMatchers:function(e){var t=o[e];if(!t)return{};var i={};return l.each(t.matchers,function(e){i[e]={label:a[e].name}}),i},getInputTypeInfoForMatcher:function(e,t){return{valueType:a[e].valueType,inputType:o[t].inputType}},getValueParser:function(e){return o[e].parser}})},function(e,t,i){"use strict";var l=i(1),n=i(2);l.Extension.AdvancedFilter.FilterOptions={},l.Extension.AdvancedFilter.FilterOptions.MatchersValueTypeValidator={single:function(e){return!(n.isUndefined(e)||n.isNull(e)||n.isArray(e)||n.isFunction(e))},array2:function(e){return n.isArray(e)&&2===e.length}},l.Extension.AdvancedFilter.FilterOptions.Matchers={
gt:{name:"greater than",valueType:"single"},gte:{name:"greater than or equal",valueType:"single"},lt:{name:"lower than",valueType:"single"},lte:{name:"lower than or equal",valueType:"single"},eq:{name:"equals",valueType:"single"},neq:{name:"does not equal",valueType:"single"},sw:{name:"starts with",valueType:"single"},ew:{name:"ends with",valueType:"single"},ct:{name:"contains",valueType:"single"},bt:{name:"between",valueType:"array2"},nbt:{name:"outside",valueType:"array2"}},l.Extension.AdvancedFilter.FilterOptions.Types={string:{parser:function(e){return e},validator:function(e){return n.isString(e)},postProcessor:function(e){return e.trim()},matchers:["sw","ew","eq","neq","ct"],inputType:"textbox"},number:{parser:function(e){return parseFloat(e)},validator:function(e){return!isNaN(e)},postProcessor:function(e){return e},matchers:["gt","gte","lt","lte","bt","nbt","eq","neq"],inputType:"textbox"},integer:{parser:function(e){return parseInt(e)},validator:function(e){return!isNaN(e)},postProcessor:function(e){return e},matchers:["gt","gte","lt","lte","bt","nbt","eq","neq"],inputType:"textbox"},percent:{parser:function(e){return parseFloat(e)},validator:function(e){return!isNaN(e)&&e>=0&&100>=e},postProcessor:function(e){return e/100},matchers:["gt","gte","lt","lte","bt","nbt","eq","neq"],inputType:"textbox"},"boolean":{parser:function(e){return!!e},validator:function(e){return n.isBoolean(e)},postProcessor:function(e){return e},matchers:["eq","neq"],inputType:"boolean-select"}}},function(e,t,i){"use strict";var l=i(2),n=i(1),r=n.Extension.AdvancedFilter.FilterOptions.Types;n.Extension.AdvancedFilter.FilterParsers={};var o=n.Extension.AdvancedFilter.FilterParsers.MongoParser=function(){};o.prototype.parse=function(e){var t=this;if(!e||!e instanceof n.Extension.AdvancedFilter.FilterModel)throw new Error("MongoParser: No (valid) filter collection provided");var i=t.getValidOnly(e),o=[];return l.each(i,function(e){var i,n=e.toJSON(),a=r[n.type];l.isArray(n.value)?(i=[],l.each(n.value,function(e){i.push(a.postProcessor(a.parser(e)))})):i=a.postProcessor(a.parser(n.value));var s={matcher:n.matcher,column:n.column,type:n.type,value:i};o.push(t.parseAttributeFilter(s))}),{$and:o}},o.prototype.getValidOnly=function(e){var t=e.get("attributeFilters");return t.where({valid:!0})},o.prototype.parseAttributeFilter=function(e){var t={};switch(e.matcher){case"sw":t[e.column]={$regex:"(?i)^"+e.value};break;case"ew":t[e.column]={$regex:"(?i)"+e.value+"$"};break;case"ct":t[e.column]={$regex:"(?i)"+e.value};break;case"gt":t[e.column]={$gt:e.value};break;case"gte":t[e.column]={$gte:e.value};break;case"lt":t[e.column]={$lt:e.value};break;case"lte":t[e.column]={$lte:e.value};break;case"bt":var i={},l={};i[e.column]={$gte:e.value[0]},l[e.column]={$lte:e.value[1]},t={$and:[i,l]};break;case"nbt":var n={},r={};n[e.column]={$lt:e.value[0]},r[e.column]={$gt:e.value[1]},t={$and:[n,r]};break;case"eq":t[e.column]={$eq:"string"===e.type?"(?i)"+e.value:e.value};break;case"neq":t[e.column]={$neq:"string"===e.type?"(?i)"+e.value:e.value}}return t};var a=n.Extension.AdvancedFilter.FilterParsers.SimpleParser=function(){};a.prototype.parse=function(e){var t=this;if(!e||!e instanceof n.Extension.AdvancedFilter.FilterModel)throw new Error("SimpleParser: No (valid) filter collection provided");var i=t.getValidOnly(e),o=[];return l.each(i,function(e){var i,n=e.toJSON(),a=r[n.type];l.isArray(n.value)?(i=[],l.each(n.value,function(e){i.push(a.postProcessor(a.parser(e)))})):i=a.postProcessor(a.parser(n.value));var s={matcher:n.matcher,column:n.column,type:n.type,value:i};o.push(t.parseAttributeFilter(s))}),o},a.prototype.getValidOnly=function(e){var t=e.get("attributeFilters");return t.where({valid:!0})},a.prototype.parseAttributeFilter=function(e){var t={};switch(e.matcher){case"sw":t={column:e.column,matcher:{type:"regex",value:"^"+e.value}};break;case"ew":t={column:e.column,matcher:{type:"regex",value:e.value+"$"}};break;case"ct":t={column:e.column,matcher:{type:"regex",value:e.value}};break;case"gt":t={column:e.column,matcher:{type:"gt",value:e.value}};break;case"gte":t={column:e.column,matcher:{type:"gte",value:e.value}};break;case"lt":t={column:e.column,matcher:{type:"lt",value:e.value}};break;case"lte":t={column:e.column,matcher:{type:"lte",value:e.value}};break;case"bt":t={column:e.column,matcher:{type:"bt",value:e.value}};break;case"nbt":t={column:e.column,matcher:{type:"nbt",value:e.value}};break;case"eq":t={column:e.column,matcher:{type:"eq",value:e.value}};break;case"neq":t={column:e.column,matcher:{type:"neq",value:e.value}}}return t}},function(e,t,i){"use strict";var l=i(2),n=i(3),r=i(1);r.Extension.AdvancedFilter.Saver=n.View.extend({className:"advancedfilter-saver",tagName:"div",template:l.template('<div class="advancedfilter-saver-input"><input type="text" value="<%-inputValue%>"></div><div class="advancedfilter-saver-buttons"><button class="remove"><%-removeText%></button><button class="reset"><%-resetText%></button><button class="cancel"><%-cancelText%></button><button class="save"><%-saveText%></button><button class="apply"><%-applyText%></button></div><div class="clearer"></div>'),events:{"click button.reset":"resetFilter","click button.cancel":"cancelFilter","click button.save":"saveFilter","click button.apply":"applyFilter","click button.remove":"removeFilter"},defaults:{resetText:"Reset",cancelText:"Cancel",saveText:"Save",applyText:"Apply",removeText:"Remove"},initialize:function(e){var t=this;if(t.options=l.extend({},t.defaults,e||{}),!t.options.filterStateModel||!t.options.filterStateModel instanceof n.Model)throw new Error("No (valid) filter state model provided");t.filterStateModel=t.options.filterStateModel,t.listenTo(t.filterStateModel,"add remove change:activeFilterId",t.render)},render:function(){var e=this;if(e.$el.empty(),null!==e.filterStateModel.get("activeFilterId")){var t=e.filterStateModel.get("filterCollection").get(e.filterStateModel.get("activeFilterId")).get("name");e.$el.html(e.template({inputValue:t,resetText:e.options.resetText,cancelText:e.options.cancelText,saveText:e.options.saveText,applyText:e.options.applyText,removeText:e.options.removeText}))}return e},saveFilter:function(e){var t=this;t.stopEvent(e);var i=t.$el.find("input").val(),l=t.filterStateModel.get("filterCollection").get(t.filterStateModel.get("activeFilterId"));""!==i?l.set("name",i):t.$el.find("input").val(l.get("name")),t.filterStateModel.trigger("filter:save")},applyFilter:function(e){var t=this;t.saveFilter(e),t.filterStateModel.trigger("filter:apply")},resetFilter:function(e){var t=this;t.stopEvent(e),t.filterStateModel.trigger("filter:reset")},cancelFilter:function(e){var t=this;t.stopEvent(e);var i=t.filterStateModel.getActiveFilter();t.$el.find("input").val(i.get("name")),t.filterStateModel.trigger("filter:cancel")},removeFilter:function(e){var t=this;t.stopEvent(e),t.filterStateModel.trigger("filter:remove")},stopEvent:function(e){e.stopPropagation(),e.preventDefault()}})},function(e,t,i){"use strict";var l=i(2),n=i(3),r=i(1);i(4),r.Extension.AdvancedFilter.SubComponents.LabelView=n.View.extend({tagName:"span",templates:{noFilterSelected:l.template("create"),filterSelected:l.template('<span class="remove"><%-filterName%></span><span class="remove-filter">x</span>')},events:{click:"labelClick","click .remove-filter":"removeClick"},defaults:{labelClass:""},initialize:function(e){var t=this;if(t.options=l.extend({},t.defaults,e||{}),!t.options.filterStateModel||!t.options.filterStateModel instanceof n.Model)throw new Error("No (valid) filter state model provided");t.filterStateModel=t.options.filterStateModel,t.$el.addClass(t.options.labelClass),t.listenTo(t.filterStateModel,"change:activeFilterId",t.render),t.listenTo(t.filterStateModel.get("filterCollection"),"change:name",t.render)},render:function(){var e=this;if(e.$el.empty(),null!==e.filterStateModel.get("activeFilterId")){e.$el.removeClass("create");var t=e.filterStateModel.getActiveFilter();e.$el.html(e.templates.filterSelected({filterName:t.get("name")}))}else e.$el.html(e.templates.noFilterSelected()),e.$el.addClass("create");return e},labelClick:function(e){var t=this;t.stopEvent(e),null===t.filterStateModel.get("activeFilterId")&&t.filterStateModel.trigger("filter:new")},removeClick:function(e){var t=this;t.stopEvent(e),t.filterStateModel.get("activeFilterId")&&(t.filterStateModel.trigger("filter:save"),t.filterStateModel.set("activeFilterId",null))},stopEvent:function(e){e.stopPropagation(),e.preventDefault()}}),r.Extension.AdvancedFilter.Selector=n.View.extend({className:"advancedfilter-selector",tagName:"div",template:l.template('<div class="filter-dropdown"></div><div class="filter-label"></div><div class="filter-search"></div>'),defaults:{FilterDropdownComponent:r.Extension.AdvancedFilter.SubComponents.FilterDropdown,LabelComponent:r.Extension.AdvancedFilter.SubComponents.LabelView,SearchComponent:r.Extension.ClientSideFilter},initialize:function(e){var t=this;if(t.options=l.extend({},t.defaults,e||{}),t.components={},!t.options.filterStateModel||!t.options.filterStateModel instanceof n.Model)throw new Error("No (valid) filter state model provided");t.filterStateModel=t.options.filterStateModel},render:function(){var e=this;e.$el.empty(),e.$el.html(e.template()),e.ui={},e.ui.$dropdown=e.$el.find(".filter-dropdown").first(),e.ui.$label=e.$el.find(".filter-label").first(),e.ui.$search=e.$el.find(".filter-search").first();var t=e.getFilterDropdownComponent();e.ui.$dropdown.append(t.render().$el);var i=e.getLabelComponent();e.ui.$label.append(i.render().$el);var l=e.getSearchComponent();return e.ui.$search.append(l.render().$el),this},getFilterDropdownComponent:function(){var e=this;return e.components.filterDropdown=new this.options.FilterDropdownComponent({filterStateModel:e.filterStateModel}),e.components.filterDropdown},getLabelComponent:function(){var e=this;return e.components.label=new this.options.LabelComponent({filterStateModel:e.filterStateModel}),e.components.label},getSearchComponent:function(){var e=this;return e.components.search=new this.options.SearchComponent({collection:e.filterStateModel.get("dataCollection"),placeholder:e.options.searchPlaceHolder||"",fields:e.options.textSearchFields,wait:150}),e.components.search}})},function(e,t){e.exports=l}])});