!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("Backgrid"),require("_"),require("Backbone"),require("jQuery")):"function"==typeof define&&define.amd?define(["Backgrid","_","Backbone","jQuery"],t):"object"==typeof exports?exports["Backgrid.Extension.AdvancedFilter"]=t(require("Backgrid"),require("_"),require("Backbone"),require("jQuery")):e["Backgrid.Extension.AdvancedFilter"]=t(e.Backgrid,e._,e.Backbone,e.jQuery)}(this,function(e,t,i,n){return function(e){function t(n){if(i[n])return i[n].exports;var l=i[n]={exports:{},id:n,loaded:!1};return e[n].call(l.exports,l,l.exports,t),l.loaded=!0,l.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){"use strict";var n=i(1);n.Extension.AdvancedFilter={SubComponents:{}},i(10),i(9),i(5),i(7),i(12),i(6),i(13),i(11),i(8)},function(t,i){t.exports=e},function(e,i){e.exports=t},function(e,t){e.exports=i},function(e,t,i){var n,l,r;/*
	  backgrid-filter
	  http://github.com/wyuenho/backgrid

	  Copyright (c) 2013 Jimmy Yuen Ho Wong and contributors
	  Licensed under the MIT @license.
	*/
!function(o,a){l=[i(2),i(3),i(1)],n=a,r="function"==typeof n?n.apply(t,l):n,!(void 0!==r&&(e.exports=r))}(this,function(e,t,i,n){"use strict";var l=i.Extension.ServerSideFilter=t.View.extend({tagName:"form",className:"backgrid-filter form-search",template:function(e){return'<span class="search">&nbsp;</span><input type="search" '+(e.placeholder?'placeholder="'+e.placeholder+'"':"")+' name="'+e.name+'" '+(e.value?'value="'+e.value+'"':"")+'/><a class="clear" data-backgrid-action="clear" href="#">&times;</a>'},events:{"keyup input[type=search]":"showClearButtonMaybe","click a[data-backgrid-action=clear]":"clear",submit:"search"},name:"q",value:null,placeholder:null,initialize:function(e){l.__super__.initialize.apply(this,arguments),this.name=e.name||this.name,this.value=e.value||this.value,this.placeholder=e.placeholder||this.placeholder,this.template=e.template||this.template;var i=this.collection,n=this;t.PageableCollection&&i instanceof t.PageableCollection&&"server"==i.mode&&(i.queryParams[this.name]=function(){return n.searchBox().val()||null})},clearSearchBox:function(){this.value=null,this.searchBox().val(null),this.showClearButtonMaybe()},showClearButtonMaybe:function(){var e=this.clearButton(),t=this.searchBox().val();t?e.show():e.hide()},searchBox:function(){return this.$el.find("input[type=search]")},clearButton:function(){return this.$el.find("a[data-backgrid-action=clear]")},query:function(){return this.value=this.searchBox().val(),this.value},search:function(e){e&&e.preventDefault();var i={},n=this.query();n&&(i[this.name]=n);var l=this.collection;t.PageableCollection&&l instanceof t.PageableCollection?l.getFirstPage({data:i,reset:!0,fetch:!0}):l.fetch({data:i,reset:!0})},clear:function(e){e&&e.preventDefault(),this.clearSearchBox();var i=this.collection;t.PageableCollection&&i instanceof t.PageableCollection?i.getFirstPage({reset:!0,fetch:!0}):i.fetch({reset:!0})},render:function(){return this.$el.empty().append(this.template({name:this.name,placeholder:this.placeholder,value:this.value})),this.showClearButtonMaybe(),this.delegateEvents(),this}}),r=i.Extension.ClientSideFilter=l.extend({events:e.extend({},l.prototype.events,{"click a[data-backgrid-action=clear]":function(e){e.preventDefault(),this.clear()},"keydown input[type=search]":"search",submit:function(e){e.preventDefault(),this.search()}}),fields:null,wait:149,initialize:function(t){r.__super__.initialize.apply(this,arguments),this.fields=t.fields||this.fields,this.wait=t.wait||this.wait,this._debounceMethods(["search","clear"]);var i=this.collection=this.collection.fullCollection||this.collection,n=this.shadowCollection=i.clone();this.listenTo(i,"add",function(e,t,i){n.add(e,i)}),this.listenTo(i,"remove",function(e,t,i){n.remove(e,i)}),this.listenTo(i,"sort",function(e){this.searchBox().val()||n.reset(e.models)}),this.listenTo(i,"reset",function(t,i){i=e.extend({reindex:!0},i||{}),i.reindex&&null==i.from&&null==i.to&&n.reset(t.models)})},_debounceMethods:function(t){e.isString(t)&&(t=[t]),this.undelegateEvents();for(var i=0,n=t.length;n>i;i++){var l=t[i],r=this[l];this[l]=e.debounce(r,this.wait)}this.delegateEvents()},makeRegExp:function(e){return new RegExp(e.trim().split(/\s+/).join("|"),"i")},makeMatcher:function(e){var t=this.makeRegExp(e);return function(e){for(var i=this.fields||e.keys(),n=0,l=i.length;l>n;n++)if(t.test(e.get(i[n])+""))return!0;return!1}},search:function(){var t=e.bind(this.makeMatcher(this.query()),this),i=this.collection;i.pageableCollection&&i.pageableCollection.getFirstPage({silent:!0}),i.reset(this.shadowCollection.filter(t),{reindex:!1})},clear:function(){this.clearSearchBox();var e=this.collection;e.pageableCollection&&e.pageableCollection.getFirstPage({silent:!0}),e.reset(this.shadowCollection.models,{reindex:!1})}}),o=i.Extension.LunrFilter=r.extend({ref:"id",fields:null,initialize:function(e){o.__super__.initialize.apply(this,arguments),this.ref=e.ref||this.ref;var t=this.collection=this.collection.fullCollection||this.collection;this.listenTo(t,"add",this.addToIndex),this.listenTo(t,"remove",this.removeFromIndex),this.listenTo(t,"reset",this.resetIndex),this.listenTo(t,"change",this.updateIndex),this.resetIndex(t)},resetIndex:function(t,i){if(i=e.extend({reindex:!0},i||{}),i.reindex){var l=this;this.index=n(function(){e.each(l.fields,function(e,t){this.field(t,e),this.ref(l.ref)},this)}),t.each(function(e){this.addToIndex(e)},this)}},addToIndex:function(e){var t=this.index,i=e.toJSON();t.documentStore.has(i[this.ref])?t.update(i):t.add(i)},removeFromIndex:function(e){var t=this.index,i=e.toJSON();t.documentStore.has(i[this.ref])&&t.remove(i)},updateIndex:function(t){var i=t.changedAttributes();i&&!e.isEmpty(e.intersection(e.keys(this.fields),e.keys(i)))&&this.index.update(t.toJSON())},search:function(){var e=this.collection;if(!this.query())return void e.reset(this.shadowCollection.models,{reindex:!1});for(var t=this.index.search(this.query()),i=[],n=0;n<t.length;n++){var l=t[n];i.push(this.shadowCollection.get(l.ref))}e.pageableCollection&&e.pageableCollection.getFirstPage({silent:!0}),e.reset(i,{reindex:!1})}})})},function(e,t,i){"use strict";var n=i(3),l=i(1),r=i(2),o=l.Extension.AdvancedFilter.AttributeFilterModel=n.Model.extend({defaults:{column:null,type:null,matcher:null,value:null,valid:!1},initialize:function(){var e=this;e.listenTo(e,"change:column change:type change:matcher change:value",e.checkValidity)},checkValidity:function(){}});l.Extension.AdvancedFilter.AttributeFilterCollection=n.Collection.extend({model:o,createNewAttributeFilter:function(){var e=this;e.add({})}});var a=l.Extension.AdvancedFilter.FilterModel=n.Model.extend({defaults:{name:null,attributeFilters:null},lastSavedState:null,filterChanged:!1,initialize:function(){var e=this;e.saveState(),e.listenTo(e.get("attributeFilters"),"change add remove",e.evtFilterChanged),e.listenTo(e,"change:name",e.evtFilterChanged)},evtFilterChanged:function(){var e=this;e.filterChanged=!0,e.trigger("filter:changed")},saveFilter:function(){var e=this;e.saveState()},resetFilter:function(){var e=this;e.get("attributeFilters").reset([])},cancelFilter:function(){var e=this;e.loadSavedState()},saveState:function(){var e=this,t=e.get("name"),i=e.get("attributeFilters");i=i&&i.length>0?i.toJSON():null,e.lastSavedState={name:t,attributeFilters:i},e.filterChanged=!1},loadSavedState:function(){var e=this;e.lastSavedState&&(e.set("name",e.lastSavedState.name),e.get("attributeFilters").reset(e.lastSavedState.attributeFilters))},removeSavedState:function(){var e=this;e.lastSavedState=null},set:function(e,t){var i=l.Extension.AdvancedFilter.AttributeFilterCollection;return void 0===e.attributeFilters||e.attributeFilters instanceof i||(e.attributeFilters=new i(e.attributeFilters)),n.Model.prototype.set.call(this,e,t)}});l.Extension.AdvancedFilter.FilterCollection=n.Collection.extend({filterNamePartial:"{count}",newFilterName:"New Filter #{count}",newFilterCount:0,model:a,createNewFilter:function(){var e=this,t=new a({name:e.getNewFilterName(e.getNewFilterNumber())});return e.add(t),t},getNewFilterNumber:function(){var e=this;if(e.newFilterCount+=1,0===e.length)return e.newFilterCount;var t=e.newFilterName.replace(e.filterNamePartial,""),i=e.filter(function(e){return 0===e.get("name").indexOf(t)}).map(function(e){return e.get("name")});if(r.isArray(i)&&i.length>0){i.sort();var n=parseInt(i[i.length-1].replace(t,""));r.isNaN(n)?n=e.newFilterCount:n+=1}else n=e.newFilterCount;return n},getNewFilterName:function(e){return this.newFilterName.replace(this.filterNamePartial,e)}})},function(e,t,i){"use strict";var n=i(2),l=i(3),r=i(1);r.Extension.AdvancedFilter.SubComponents.FilterDropdownItemview=l.View.extend({className:"advancedfilter-dropdown-item",template:n.template("<span class='indicator'></span><span class='filter-name'><%= name %></span>"),tagName:"li",events:{click:"setActiveFilter"},initialize:function(e){var t=this;t.filterStateModel=e.parentView.filterStateModel,t.filter=e.filter,n.bindAll(t,"render","setActiveFilter"),t.listenTo(t.filter,"change:name",t.render,t)},setActiveFilter:function(e){var t=this;e&&t.stopPropagation(e),t.filterStateModel.setActiveFilter(t.filter)},render:function(){var e=this;return e.$el.empty(),e.$el.append(e.template({name:e.filter.get("name")})),e.filterStateModel.get("activeFilterId")===e.filter.cid?e.$el.addClass("active"):e.$el.removeClass("active"),e},stopPropagation:function(e){e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault()}}),r.Extension.AdvancedFilter.SubComponents.FilterDropdownContainer=l.View.extend({className:"filter-dropdown-container",defaults:{DropdownItemView:r.Extension.AdvancedFilter.SubComponents.FilterDropdownItemview},initialize:function(e){var t=this;t.options=n.extend({},t.defaults,e||{}),t.parentView=t.options.parentView,t.listenTo(t.parentView.filterStateModel.get("filterCollection"),"add remove",t.render),t.listenTo(t.parentView.filterStateModel,"change:activeFilterId",t.render)},render:function(){var e=this;return e.$el.empty(),e.parentView.filterStateModel.get("filterCollection").each(function(t){e.$el.append(new e.options.DropdownItemView({filter:t,parentView:e.parentView}).render().$el)}),e},open:function(){var e=this;e.$el.addClass("open");var t,i=e.parentView.$dropdownButton;if("auto"===e.options.align){var n=document.body.clientWidth||document.body.clientWidth;t=i.offset().left+e.$el.outerWidth()>n?"left":"right"}else t="left"===e.options.align||"right"===e.options.align?"right"===e.options.align?"right":"left":"right";var l;"left"===t?(l=i.offset().left+i.outerWidth()-e.$el.outerWidth(),e.$el.css("left",l+"px")):(l=i.offset().left,e.$el.css("left",l+"px"));var r=i.offset().top+i.outerHeight();e.$el.css("top",r+"px")},close:function(){this.$el.removeClass("open")}}),r.Extension.AdvancedFilter.SubComponents.FilterDropdown=l.View.extend({tagName:"div",defaultEvents:{click:"stopPropagation"},defaults:{width:null,closeOnEsc:!0,closeOnClick:!0,openOnInit:!1,buttonTemplate:n.template("<button class='dropdown-button <%-buttonClass%>'><%=buttonText%></button>"),buttonClass:"",buttonText:"Filter &#9660;",DropdownView:r.Extension.AdvancedFilter.SubComponents.FilterDropdownContainer,dropdownAlign:"auto"},initialize:function(e){var t=this;if(t.options=n.extend({},t.defaults,e||{}),t.events=n.extend({},t.defaultEvents,t.events||{}),!t.options.filterStateModel||!t.options.filterStateModel instanceof l.Model)throw new Error("No (valid) filter state model provided");t.filterStateModel=t.options.filterStateModel,n.bindAll(t,"deferClose","stopDeferClose","closeOnEsc","toggle","render","open","close"),document.body.addEventListener("click",t.deferClose,!0),t.options.closeOnEsc&&document.body.addEventListener("keyup",t.closeOnEsc,!1),t.$el.on("click",t.stopDeferClose),t.setup(),t.listenTo(t.filterStateModel.get("filterCollection"),"add remove",t.checkDisabled)},delayStart:function(){clearTimeout(this.closeTimeout),this.delayTimeout=setTimeout(this.open,this.options.delay)},delayEnd:function(){clearTimeout(this.delayTimeout),this.closeTimeout=setTimeout(this.close,300)},setup:function(){var e=this;e.options.width&&e.$el.width(e.options.width+"px"),e.$dropdownButton=l.$(e.options.buttonTemplate({buttonClass:e.options.buttonClass,buttonText:e.options.buttonText})).click(e.toggle),e.dropdownContainerView=new e.options.DropdownView({filterStateModel:e.filterStateModel,align:e.options.dropdownAlign,parentView:e}).render(),document.body.appendChild(e.dropdownContainerView.el)},render:function(){var e=this;return e.$el.empty(),e.$el.html(e.$dropdownButton),e.checkDisabled(),e},checkDisabled:function(){var e=this;e.filterStateModel.get("filterCollection").length>0?e.$dropdownButton.removeAttr("disabled"):e.$dropdownButton.attr("disabled","disabled")},stopPropagation:function(e){e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault()},toggle:function(e){var t=this;t.isOpen!==!0?t.open(e):t.close(e)},open:function(e){var t=this;clearTimeout(t.closeTimeout),clearTimeout(t.deferCloseTimeout),e&&(e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0),t.isOpen||(t.isOpen=!0,t.$el.addClass("open"),t.dropdownContainerView.open())},close:function(e){var t=this;t.isOpen&&(t.isOpen=!1,t.$el.removeClass("open"),t.dropdownContainerView.close())},closeOnEsc:function(e){27===e.which&&this.deferClose()},deferClose:function(){this.deferCloseTimeout=setTimeout(this.close,0)},stopDeferClose:function(e){clearTimeout(this.deferCloseTimeout)},remove:function(){var e=this;return e.dropdownContainerView.remove(),document.body.removeEventListener("click",e.deferClose),e.options.closeOnEsc&&document.body.removeEventListener("keyup",e.closeOnEsc),e.$el.off("click",e.stopDeferClose),e.$dropdownButton.off("click",e.toggle),l.View.prototype.remove.apply(e,arguments)}})},function(e,t,i){"use strict";var n=i(2),l=i(14),r=i(3),o=i(1),a=r.View.extend({template:n.template('<button class="<%-buttonClass%>"><%-buttonText%></button>'),defaults:{buttonText:"+",buttonClass:""},events:{click:"clickHandler"},initialize:function(e){var t=this;if(t.options=n.extend({},t.defaults,e||{}),!t.options.filterStateModel||!t.options.filterStateModel instanceof r.Model)throw new Error("ButtonView: No (valid) filter state model provided");t.filterStateModel=t.options.filterStateModel},render:function(){var e=this;return e.$el.empty(),e.$el.append(e.template({buttonText:e.options.buttonText,buttonClass:e.options.buttonClass})),e},clickHandler:function(e){var t=this;t.stopPropagation(e)},stopPropagation:function(e){e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault()}}),s=a.extend({defaults:{buttonText:"+",buttonClass:"new-attribute-filter"},clickHandler:function(e){var t=this;t.stopPropagation(e);var i=t.filterStateModel,n=i.getActiveFilter();n.get("attributeFilters").createNewAttributeFilter(),t.render()}}),c=a.extend({defaults:{buttonText:"-",buttonClass:"remove-attribute-filter"},clickHandler:function(e){var t=this;t.stopPropagation(e);var i=t.filterStateModel,n=i.get("activeFilterId"),l=i.get("filterCollection").get(n);l.get("attributeFilters").remove(t.filter),t.render()}}),d=r.View.extend({className:"column-selector",tagName:"select",events:{change:"columnUpdate"},render:function(){var e=this;return e.$el.empty(),e.$el.append(l("<option></option>").attr("value","test").text("test!")),e.$el.append(l("<option></option>").attr("value","test2").text("test2!")),e},columnUpdate:function(){console.log("column change!")}}),u=r.View.extend({className:"matcher-selector",tagName:"select",events:{change:"matcherUpdate"},render:function(){var e=this;return e.$el.empty(),e.$el.append(l("<option></option>").attr("value","test").text("test!")),e.$el.append(l("<option></option>").attr("value","test2").text("test2!")),e.$el.append(l("<option></option>").attr("value","test3").text("test3!")),e},matcherUpdate:function(){console.log("matcher change!")}}),f=r.View.extend({className:"valuer",tagName:"input",events:{change:"valueUpdate"},initialize:function(e){var t=this;if(t.options=n.extend({},t.defaults,e||{}),!t.options.filter||!t.options.filter instanceof r.Model)throw new Error("No (valid) filter state model provided");t.filter=t.options.filter},render:function(){var e=this;return e.$el.empty(),e.$el.val(e.filter.get("value")),e},matcherUpdate:function(){console.log("matcher change!"),self.filter.set("value",self.$el.val())}}),p=r.View.extend({className:"column-filter",tagName:"div",template:n.template('<div class="filter-editor-column"><div class="filter-editor-matcher"><div class="filter-editor-value">'),events:{change:"columnUpdate"},defaults:{ColumnSelectorView:d,MatcherView:u,ValueView:f},initialize:function(e){var t=this;if(t.options=n.extend({},t.defaults,e||{}),!t.options.filter||!t.options.filter instanceof r.Model)throw new Error("No (valid) filter state model provided");t.filter=t.options.filter},render:function(){var e=this;return e.$el.empty(),e.$el.append(e.template()),e.$el.append(l("<option></option>").attr("value","test").text("test!")),e.$el.append(l("<option></option>").attr("value","test2").text("test2!")),e}});o.Extension.AdvancedFilter.SubComponents.FilterView=r.View.extend({className:"filter-editor",tagName:"div",template:n.template('<div class="filter-editor-columnfilter"><div class="filter-editor-addremove">'),defaults:{ColumnFilterView:p,NewFilterButtonView:s,RemoveFilterButtonView:c},initialize:function(e){var t=this;if(t.options=n.extend({},t.defaults,e||{}),!t.options.filterStateModel||!t.options.filterStateModel instanceof r.Model)throw new Error("No (valid) filter state model provided");if(t.filterStateModel=t.options.filterStateModel,!t.options.filter||!t.options.filter instanceof r.Model)throw new Error("No (valid) filter state model provided");t.filter=t.options.filter,t.listenTo(t.filter,"change:column change:type",t.render)},render:function(){var e=this;e.$el.empty(),e.$el.append(e.template());var t=new this.options.ColumnFilterView({filter:e.filter});e.$el.find(".filter-editor-column").append(t.render().$el);var i=new this.options.NewFilterButtonView({filterStateModel:e.filterStateModel});e.$el.find(".filter-editor-addremove").append(i.render().$el);var n=new this.options.RemoveFilterButtonView({filterStateModel:e.filterStateModel,filter:e.filter});return e.$el.find(".filter-editor-addremove").append(n.render().$el),e}}),o.Extension.AdvancedFilter.Editor=r.View.extend({className:"advancedfilter-editor",tagName:"div",defaults:{NewFilterButtonView:s},initialize:function(e){var t=this;if(t.options=n.extend({},t.defaults,e||{}),!t.options.filterStateModel||!t.options.filterStateModel instanceof r.Model)throw new Error("No (valid) filter state model provided");t.filterStateModel=t.options.filterStateModel,t.listenTo(t.filterStateModel,"change:activeFilterId",t.bindFilter),t.bindFilter()},bindFilter:function(){var e=this,t=e.filterStateModel,i=t.get("activeFilterId");e.activeFilter&&t.get("filterCollection").contains(e.activeFilter)&&e.stopListening(e.activeFilter.get("attributeFilters")),i?(e.activeFilter=t.get("filterCollection").get(i),e.listenTo(e.activeFilter.get("attributeFilters"),"add remove reset",e.render)):e.activeFilter=null,e.render()},render:function(){var e=this;if(e.$el.empty(),e.activeFilter){var t=e.activeFilter;if(t.get("attributeFilters").length>0)t.get("attributeFilters").each(function(t){var i=new o.Extension.AdvancedFilter.SubComponents.FilterView({filterStateModel:e.filterStateModel,filter:t});e.$el.append(i.render().$el)});else{var i=new e.options.NewFilterButtonView({filterStateModel:e.filterStateModel});e.$el.append(i.render().$el)}}return e}})},function(e,t,i){"use strict";var n=i(2),l=i(3),r=i(1);r.Extension.AdvancedFilter.Main=l.View.extend({className:"advancedfilter",defaults:{SelectorView:r.Extension.AdvancedFilter.Selector,FilterView:r.Extension.AdvancedFilter.Editor,SaverView:r.Extension.AdvancedFilter.Saver},initialize:function(e){var t=this;if(t.options=n.extend({},t.defaults,e||{}),t.components={},!t.options.collection||!t.options.collection instanceof l.Collection)throw new Error("AdvancedFilter: data collection is required.");if(!t.options.columns||!t.options.columns instanceof r.Columns)throw new Error("AdvancedFilter: columns are required.");(!t.options.filters||n.isArray(t.options.filter)&&n.isEmpty(t.options.filter))&&(t.options.filters=new r.Extension.AdvancedFilter.FilterCollection),t.createFilterStateModel(t.options)},render:function(){var e=this;e.$el.empty();var t=e.components.selector=new e.options.SelectorView({filterStateModel:e.filterStateModel});e.$el.append(t.render().$el);var i=e.components.editor=new e.options.FilterView({filterStateModel:e.filterStateModel});e.$el.append(i.render().$el);var n=e.components.saver=new e.options.SaverView({filterStateModel:e.filterStateModel});return e.$el.append(n.render().$el),e},verifyFilterId:function(e,t){return e.get(t)?!0:!1},createFilterStateModel:function(e){var t=this,i=t.verifyFilterId(e.filters,e.activeFilterId);t.filterStateModel=new r.Extension.AdvancedFilter.FilterStateModel({dataCollection:e.collection,columnCollection:e.columns,filterCollection:e.filters,activeFilterId:i?e.filters.get(e.activeFilterId).cid:null}),t.bindFilterStateEvents()},bindFilterStateEvents:function(){var e=this,t=e.filterStateModel;e.listenTo(t,"filter:new",e.evtNewFilter),e.listenTo(t,"filter:save",e.evtSaveFilter),e.listenTo(t,"filter:reset",e.evtResetFilter),e.listenTo(t,"filter:cancel",e.evtCancelFilter),e.listenTo(t,"filter:remove",e.evtRemoveFilter)},evtNewFilter:function(){var e=this,t=e.filterStateModel,i=t.get("filterCollection").createNewFilter();t.set("activeFilterId",i.cid),e.trigger("filter:new",i.cid,i)},evtSaveFilter:function(){var e=this,t=e.filterStateModel,i=t.getActiveFilter();i&&(i.saveFilter(),e.trigger("filter:save",i.cid,i))},evtResetFilter:function(){var e=this,t=e.filterStateModel.getActiveFilter();t.resetFilter(),e.trigger("filter:reset",t.cid,t)},evtCancelFilter:function(){var e=this,t=e.filterStateModel.getActiveFilter(),i={name:t.get("name"),attributeFilters:t.get("attributeFilters")?t.get("attributeFilters").toJSON():null};t.cancelFilter(),e.trigger("filter:cancel",t.cid,t,i)},evtRemoveFilter:function(){var e=this,t=e.filterStateModel,i=t.get("activeFilterId"),n=t.get("filterCollection").get(i),l=n.get("name");t.set("activeFilterId",null),t.get("filterCollection").remove(n),e.trigger("filter:remove",i,l)},remove:function(){var e=this;return e.components.selector.remove(),e.components.editor.remove(),e.components.saver.remove(),l.View.prototype.remove.apply(e,arguments)}})},function(e,t,i){"use strict";var n=i(3),l=i(1);l.Extension.AdvancedFilter.FilterStateModel=n.Model.extend({defaults:{activeFilterId:null,columnCollection:null,dataCollection:null,filterCollection:null},getActiveFilter:function(){var e=this,t=e.get("activeFilterId");return e.get("filterCollection").get(t)},setActiveFilter:function(e){var t=this;t.trigger("filter:save");var i;i=e instanceof l.Extension.AdvancedFilter.FilterModel?e.cid:e,t.get("filterCollection").get(i)&&t.set("activeFilterId",i)}})},function(e,t,i){"use strict";var n=i(1),l=i(2);n.Extension.AdvancedFilter.FilterOptions={},n.Extension.AdvancedFilter.FilterOptions.Matchers={gt:{name:"greater than"},gte:{name:"greater than or equal"},lt:{name:"lower than"},lte:{name:"lower than or equal"},eq:{name:"equals"},neq:{name:"does not equal"},sw:{name:"starts with"},ew:{name:"ends with"},ct:{name:"contains"},bt:{name:"between"},nbt:{name:"outside"}},n.Extension.AdvancedFilter.FilterOptions.Types={text:{parser:function(e){return e},validation:function(e){return l.isString(e)},postProcess:function(e){return e.trim()},matchers:["sw","ew","eq","neq","ct"]},number:{parser:function(e){return parseFloat(e)},validation:function(e){return!isNaN(e)},postProcess:function(e){return e},matchers:["gt","gte","lt","lte","bt","nbt","eq","neq"]},percent:{parser:function(e){return parseFloat(e)},validation:function(e){return!isNaN(e)&&e>=0&&100>=e},postProcess:function(e){return e/100},matchers:["gt","gte","lt","lte","bt","nbt","eq","neq"]},"boolean":{parser:function(e){return!!e},validation:function(e){return l.isBoolean(e)},postProcess:function(e){return e},matchers:["eq","neq"]}}},function(e,t,i){"use strict";var n=i(2),l=i(1);l.Extension.AdvancedFilter.FilterParsers={};var r=l.Extension.AdvancedFilter.FilterParsers.MongoParser=function(){};r.prototype.parse=function(e){var t=this;if(!e||!e instanceof l.Extension.AdvancedFilter.FilterModel)throw new Error("MongoParser: No (valid) filter collection provided");var i=t.getValidOnly(e),r=[];return n.each(i,function(e){r.push(t.parseAttributeFilter(e))}),{$and:r}},r.prototype.getValidOnly=function(e){var t=e.get("attributeFilters");return t.where({valid:!0})},r.prototype.parseAttributeFilter=function(e){var t=this,i={};switch(e.get("type")){case"text":i=t.parseTextFilter(e.toJSON());break;case"number":i=t.parseNumberFilter(e.toJSON());break;case"percent":i=t.parseNumberFilter(e.toJSON());break;case"boolean":i=t.parseBooleanFilter(e.toJSON())}return i},r.prototype.parseTextFilter=function(e){var t={};switch(e.matcher){case"eq":t[e.column]={$eq:e.value};break;case"neq":t[e.column]={$neq:e.value};break;case"sw":t[e.column]=new RegExp("^"+e.value);break;case"ew":t[e.column]=new RegExp(e.value+"$");break;case"ct":t[e.column]=new RegExp(e.value)}return t},r.prototype.parseNumberFilter=function(e){var t={};switch(e.matcher){case"eq":t[e.column]={$eq:e.value};break;case"neq":t[e.column]={$neq:e.value};break;case"gt":t[e.column]={$gt:e.value};break;case"gte":t[e.column]={$gte:e.value};break;case"lt":t[e.column]={$lt:e.value};break;case"lte":t[e.column]={$lte:e.value};break;case"bt":var i={},n={};i[e.column]={$gte:e.value[0]},n[e.column]={$lte:e.value[1]},t={$and:[i,n]};break;case"nbt":var l={},r={};l[e.column]={$lt:e.value[0]},r[e.column]={$gt:e.value[1]},t={$and:[l,r]}}return t},r.prototype.parseBooleanFilter=function(e){var t={};switch(e.matcher){case"eq":t[e.column]={$eq:e.value};break;case"neq":t[e.column]={$neq:e.value}}return t}},function(e,t,i){"use strict";var n=i(2),l=i(3),r=i(1);r.Extension.AdvancedFilter.Saver=l.View.extend({className:"advancedfilter-saver",tagName:"div",template:n.template('<div class="advancedfilter-saver-input"><input type="text" value="<%-inputValue%>"></div><div class="advancedfilter-saver-buttons"><button class="save"><%-saveText%></button><button class="cancel"><%-cancelText%></button><button class="reset"><%-resetText%></button><button class="remove"><%-removeText%></button></div>'),events:{"click button.reset":"resetFilter","click button.cancel":"cancelFilter","click button.save":"saveFilter","click button.remove":"removeFilter"},defaults:{resetText:"Reset",cancelText:"Cancel",saveText:"Save",removeText:"Remove"},initialize:function(e){var t=this;if(t.options=n.extend({},t.defaults,e||{}),!t.options.filterStateModel||!t.options.filterStateModel instanceof l.Model)throw new Error("No (valid) filter state model provided");t.filterStateModel=t.options.filterStateModel,t.listenTo(t.filterStateModel,"add remove change:activeFilterId",t.render)},render:function(){var e=this;if(e.$el.empty(),null!==e.filterStateModel.get("activeFilterId")){var t=e.filterStateModel.get("filterCollection").get(e.filterStateModel.get("activeFilterId")).get("name");e.$el.html(e.template({inputValue:t,resetText:e.options.resetText,cancelText:e.options.cancelText,saveText:e.options.saveText,removeText:e.options.removeText}))}return e},saveFilter:function(e){var t=this;t.stopEvent(e);var i=t.$el.find("input").val(),n=t.filterStateModel.get("filterCollection").get(t.filterStateModel.get("activeFilterId"));""!==i?n.set("name",i):t.$el.find("input").val(n.get("name")),t.filterStateModel.trigger("filter:save")},resetFilter:function(e){var t=this;t.stopEvent(e),t.filterStateModel.trigger("filter:reset")},cancelFilter:function(e){var t=this;t.stopEvent(e);var i=t.filterStateModel.getActiveFilter();t.$el.find("input").val(i.get("name")),t.filterStateModel.trigger("filter:cancel")},removeFilter:function(e){var t=this;t.stopEvent(e),t.filterStateModel.trigger("filter:remove")},stopEvent:function(e){e.stopPropagation(),e.preventDefault()}})},function(e,t,i){"use strict";var n=i(2),l=i(3),r=i(1);i(4),r.Extension.AdvancedFilter.SubComponents.LabelView=l.View.extend({tagName:"span",templates:{noFilterSelected:n.template("create"),filterSelected:n.template('<span class="remove"><%-filterName%></span><span class="remove-filter">x</span>')},events:{click:"labelClick","click .remove-filter":"removeClick"},defaults:{labelClass:""},initialize:function(e){var t=this;if(t.options=n.extend({},t.defaults,e||{}),!t.options.filterStateModel||!t.options.filterStateModel instanceof l.Model)throw new Error("No (valid) filter state model provided");t.filterStateModel=t.options.filterStateModel,t.$el.addClass(t.options.labelClass),t.listenTo(t.filterStateModel,"change:activeFilterId",t.render),t.listenTo(t.filterStateModel.get("filterCollection"),"change:name",t.render)},render:function(){var e=this;if(e.$el.empty(),null!==e.filterStateModel.get("activeFilterId")){e.$el.removeClass("create");var t=e.filterStateModel.getActiveFilter();e.$el.html(e.templates.filterSelected({filterName:t.get("name")}))}else e.$el.html(e.templates.noFilterSelected()),e.$el.addClass("create");return e},labelClick:function(e){var t=this;t.stopEvent(e),null===t.filterStateModel.get("activeFilterId")&&t.filterStateModel.trigger("filter:new")},removeClick:function(e){var t=this;t.stopEvent(e),t.filterStateModel.get("activeFilterId")&&(t.filterStateModel.trigger("filter:save"),t.filterStateModel.set("activeFilterId",null))},stopEvent:function(e){e.stopPropagation(),e.preventDefault()}}),r.Extension.AdvancedFilter.Selector=l.View.extend({className:"advancedfilter-selector",tagName:"div",template:n.template('<div class="filter-dropdown"></div><div class="filter-label"></div><div class="filter-search"></div>'),defaults:{FilterDropdownComponent:r.Extension.AdvancedFilter.SubComponents.FilterDropdown,LabelComponent:r.Extension.AdvancedFilter.SubComponents.LabelView,SearchComponent:r.Extension.ClientSideFilter},initialize:function(e){var t=this;if(t.options=n.extend({},t.defaults,e||{}),t.components={},!t.options.filterStateModel||!t.options.filterStateModel instanceof l.Model)throw new Error("No (valid) filter state model provided");t.filterStateModel=t.options.filterStateModel},render:function(){var e=this;e.$el.empty(),e.$el.html(e.template()),e.ui={},e.ui.$dropdown=e.$el.find(".filter-dropdown").first(),e.ui.$label=e.$el.find(".filter-label").first(),e.ui.$search=e.$el.find(".filter-search").first();var t=e.getFilterDropdownComponent();e.ui.$dropdown.append(t.render().$el);var i=e.getLabelComponent();e.ui.$label.append(i.render().$el);var n=e.getSearchComponent();return e.ui.$search.append(n.render().$el),this},getFilterDropdownComponent:function(){var e=this;return e.components.filterDropdown=new this.options.FilterDropdownComponent({filterStateModel:e.filterStateModel}),e.components.filterDropdown},getLabelComponent:function(){var e=this;return e.components.label=new this.options.LabelComponent({filterStateModel:e.filterStateModel}),e.components.label},getSearchComponent:function(){var e=this;return e.components.search=new this.options.SearchComponent({collection:e.filterStateModel.get("dataCollection"),placeholder:e.options.searchPlaceHolder||"",fields:e.options.textSearchFields,wait:150}),e.components.search}})},function(e,t){e.exports=n}])});