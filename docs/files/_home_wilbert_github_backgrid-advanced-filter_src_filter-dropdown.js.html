<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>/home/wilbert/github/backgrid-advanced-filter/src/filter-dropdown.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/AdvancedFilter.AttributeFilterCollection.html">AdvancedFilter.AttributeFilterCollection</a></li>
            
                <li><a href="../classes/AdvancedFilter.AttributeFilterModel.html">AdvancedFilter.AttributeFilterModel</a></li>
            
                <li><a href="../classes/AdvancedFilter.Editor.html">AdvancedFilter.Editor</a></li>
            
                <li><a href="../classes/AdvancedFilter.FilterCollection.html">AdvancedFilter.FilterCollection</a></li>
            
                <li><a href="../classes/AdvancedFilter.FilterModel.html">AdvancedFilter.FilterModel</a></li>
            
                <li><a href="../classes/AdvancedFilter.Main.html">AdvancedFilter.Main</a></li>
            
                <li><a href="../classes/AdvancedFilter.Saver.html">AdvancedFilter.Saver</a></li>
            
                <li><a href="../classes/AdvancedFilter.Selector.html">AdvancedFilter.Selector</a></li>
            
                <li><a href="../classes/AdvancedFilter.Subcomponents.FilterDropdown.html">AdvancedFilter.Subcomponents.FilterDropdown</a></li>
            
                <li><a href="../classes/AdvancedFilter.Subcomponents.FilterDropdownContainer.html">AdvancedFilter.Subcomponents.FilterDropdownContainer</a></li>
            
                <li><a href="../classes/AdvancedFilter.Subcomponents.FilterDropdownItemview.html">AdvancedFilter.Subcomponents.FilterDropdownItemview</a></li>
            
                <li><a href="../classes/AdvancedFilter.SubComponents.LabelView.html">AdvancedFilter.SubComponents.LabelView</a></li>
            
                <li><a href="../classes/ColumnFilterView.html">ColumnFilterView</a></li>
            
                <li><a href="../classes/FilterStateModel.html">FilterStateModel</a></li>
            
                <li><a href="../classes/FilterView.html">FilterView</a></li>
            
                <li><a href="../classes/MatcherContainerView.html">MatcherContainerView</a></li>
            
                <li><a href="../classes/MatcherSelectorView.html">MatcherSelectorView</a></li>
            
                <li><a href="../classes/MongoParser.html">MongoParser</a></li>
            
                <li><a href="../classes/NewFilterButtonView.html">NewFilterButtonView</a></li>
            
                <li><a href="../classes/RemoveFilterButtonView.html">RemoveFilterButtonView</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/AdvancedFilter.html">AdvancedFilter</a></li>
            
                <li><a href="../modules/AdvancedFilter.Editor.html">AdvancedFilter.Editor</a></li>
            
                <li><a href="../modules/AdvancedFilter.FilterCollection.html">AdvancedFilter.FilterCollection</a></li>
            
                <li><a href="../modules/AdvancedFilter.FilterOptions.html">AdvancedFilter.FilterOptions</a></li>
            
                <li><a href="../modules/AdvancedFilter.FilterParsers.html">AdvancedFilter.FilterParsers</a></li>
            
                <li><a href="../modules/AdvancedFilter.FilterStateModel.html">AdvancedFilter.FilterStateModel</a></li>
            
                <li><a href="../modules/AdvancedFilter.Saver.html">AdvancedFilter.Saver</a></li>
            
                <li><a href="../modules/AdvancedFilter.Selector.html">AdvancedFilter.Selector</a></li>
            
                <li><a href="../modules/AdvancedFilter.Subcomponents.html">AdvancedFilter.Subcomponents</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: /home/wilbert/github/backgrid-advanced-filter/src/filter-dropdown.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&quot;use strict&quot;;
/**
 * Dropdown subcomponent
 *
 * @module AdvancedFilter.Subcomponents
 */

// Dependencies
var _ = require(&quot;underscore&quot;);
var Backbone = require(&quot;backbone&quot;);
var Backgrid = require(&quot;backgrid&quot;);

/**
 * A dropdown item view
 *
 * @class AdvancedFilter.Subcomponents.FilterDropdownItemview
 * @extends Backbone.View
 */
Backgrid.Extension.AdvancedFilter.SubComponents.FilterDropdownItemview = Backbone.View.extend({
  className: &quot;advancedfilter-dropdown-item&quot;,
  template: _.template(&quot;&lt;span class=&#x27;indicator&#x27;&gt;&lt;/span&gt;&lt;span class=&#x27;filter-name&#x27;&gt;&lt;%= name %&gt;&lt;/span&gt;&quot;),
  tagName: &quot;li&quot;,
  events: {
    &quot;click&quot;: &quot;setActiveFilter&quot;
  },

  /**
   * @method initialize
   * @param {object} opts
   * @param {Backgrid.Extension.ColumnManager} opts.columnManager ColumnManager instance.
   * @param {Backgrid.Column} opts.column A backgrid column.
   */
  initialize: function (opts) {
    var self = this;

    self.filterStateModel = opts.parentView.filterStateModel;
    self.filter = opts.filter;

    _.bindAll(self, &quot;render&quot;, &quot;setActiveFilter&quot;);
    self.listenTo(self.filter, &quot;change:name&quot;, self.render, self);
  },

  /**
   * Activates current filer
   *
   * @method setActiveFilter
   * @param {object} e
   */
  setActiveFilter: function (e) {
    var self = this;
    if (e) {
      self.stopPropagation(e);
    }

    self.filterStateModel.setActiveFilter(self.filter);
  },

  /**
   * @method render
   * @return {DropDownItemView}
   */
  render: function () {
    var self = this;

    self.$el.empty();

    self.$el.append(self.template({
      name: self.filter.get(&quot;name&quot;)
    }));

    if (self.filterStateModel.get(&quot;activeFilterId&quot;) === self.filter.cid) {
      self.$el.addClass(&quot;active&quot;);
    }
    else {
      self.$el.removeClass(&quot;active&quot;);
    }

    return self;
  },

  /**
   * Convenience function to stop event propagation.
   *
   * @method stopPropagation
   * @param {object} e
   * @private
   */
  stopPropagation: function (e) {
    e.stopPropagation();
    e.stopImmediatePropagation();
    e.preventDefault();
  }
});

/**
 * Filter dropdown view container.
 *
 * @class AdvancedFilter.Subcomponents.FilterDropdownContainer
 * @extends Backbone.view
 */
Backgrid.Extension.AdvancedFilter.SubComponents.FilterDropdownContainer = Backbone.View.extend({
  className: &quot;filter-dropdown-container&quot;,
  defaults: {
    DropdownItemView: Backgrid.Extension.AdvancedFilter.SubComponents.FilterDropdownItemview
  },

  initialize: function (options) {
    var self = this;
    self.options = _.extend({}, self.defaults, options || {});

    // Input argument checking
    self.parentView = self.options.parentView;

    // Bind events
    self.listenTo(self.parentView.filterStateModel.get(&quot;filterCollection&quot;), &quot;add remove&quot;, self.render);
    self.listenTo(self.parentView.filterStateModel, &quot;change:activeFilterId&quot;, self.render);
  },

  /**
   * @method render
   * @return {DropDownView}
   */
  render: function () {
    var self = this;
    self.$el.empty();

    // List all filters
    self.parentView.filterStateModel.get(&quot;filterCollection&quot;).each(function (filter) {
      self.$el.append(new self.options.DropdownItemView({
        filter: filter,
        parentView: self.parentView
      }).render().$el);
    });

    return self;
  },

  /**
   * Opens the dropdown.
   *
   * @method open
   */
  open: function () {
    var self = this;

    self.$el.addClass(&quot;open&quot;);

    // Get button
    var $button = self.parentView.$dropdownButton;

    // Align
    var align;
    if (self.options.align === &quot;auto&quot;) {
      // Determine what alignment fits
      var viewPortWidth = document.body.clientWidth || document.body.clientWidth;
      align = (($button.offset().left + self.$el.outerWidth()) &gt; viewPortWidth) ? &quot;left&quot; : &quot;right&quot;;
    }
    else {
      align = (self.options.align === &quot;left&quot; || self.options.align === &quot;right&quot;) ?
        (self.options.align === &quot;right&quot; ? &quot;right&quot; : &quot;left&quot;) : &quot;right&quot;;
    }

    var offset;
    if (align === &quot;left&quot;) {
      // Align right by default
      offset = $button.offset().left + $button.outerWidth() - self.$el.outerWidth();
      self.$el.css(&quot;left&quot;, offset + &quot;px&quot;);
    }
    else {
      offset = $button.offset().left;
      self.$el.css(&quot;left&quot;, offset + &quot;px&quot;);
    }

    // Height position
    var offsetHeight = $button.offset().top + $button.outerHeight();
    self.$el.css(&quot;top&quot;, offsetHeight + &quot;px&quot;);
  },

  /**
   * Closes the dropdown.
   *
   * @method close
   */
  close: function () {
    this.$el.removeClass(&quot;open&quot;);
  }
});

/**
 * @class AdvancedFilter.Subcomponents.FilterDropdown
 * @extends Backbone.View
 */
Backgrid.Extension.AdvancedFilter.SubComponents.FilterDropdown = Backbone.View.extend({
  tagName: &quot;div&quot;,
  defaultEvents: {
    &quot;click&quot;: &quot;stopPropagation&quot;
  },
  defaults: {
    width: null,
    closeOnEsc: true,
    closeOnClick: true,
    openOnInit: false,

    // Button
    buttonTemplate: _.template(&quot;&lt;button class=&#x27;dropdown-button &lt;%-buttonClass%&gt;&#x27;&gt;&lt;%=buttonText%&gt;&lt;/button&gt;&quot;),
    buttonClass: &quot;&quot;,
    buttonText: &quot;Filter &amp;#9660;&quot;,

    // Container
    DropdownView: Backgrid.Extension.AdvancedFilter.SubComponents.FilterDropdownContainer,
    dropdownAlign: &quot;auto&quot;
  },

  /**
   * @method initialize
   * @param {Object} opts
   * @param {Backgrid.Extension.AdvancedFilter.FilterStateModel} opts.filterStateModel
   */
  initialize: function (opts) {
    var self = this;
    self.options = _.extend({}, self.defaults, opts || {});
    self.events = _.extend({}, self.defaultEvents, self.events || {});

    // Option checking
    if (!self.options.filterStateModel ||
      !self.options.filterStateModel instanceof Backbone.Model) {
      throw new Error(&quot;No (valid) filter state model provided&quot;);
    }
    self.filterStateModel = self.options.filterStateModel;

    // Bind scope to events
    _.bindAll(self, &quot;deferClose&quot;, &quot;stopDeferClose&quot;, &quot;closeOnEsc&quot;, &quot;toggle&quot;, &quot;render&quot;, &quot;open&quot;, &quot;close&quot;);

    // UI events
    document.body.addEventListener(&quot;click&quot;, self.deferClose, true);
    if (self.options.closeOnEsc) {
      document.body.addEventListener(&quot;keyup&quot;, self.closeOnEsc, false);
    }
    self.$el.on(&quot;click&quot;, self.stopDeferClose);

    // Create elements
    self.setup();

    // Listen for dropdown view events indicating to open and/or close
    self.listenTo(self.filterStateModel.get(&quot;filterCollection&quot;), &quot;add remove&quot;, self.checkDisabled);
  },

  /**
   * @method delayStart
   * @private
   */
  delayStart: function () {
    clearTimeout(this.closeTimeout);
    this.delayTimeout = setTimeout(this.open, this.options.delay);
  },

  /**
   * @method delayEnd
   * @private
   */
  delayEnd: function () {
    clearTimeout(this.delayTimeout);
    this.closeTimeout = setTimeout(this.close, 300);
  },

  /**
   * @method setup
   * @private
   */
  setup: function () {
    var self = this;

    // Override element width
    if (self.options.width) {
      self.$el.width(self.options.width + &quot;px&quot;);
    }

    // Create button element
    self.$dropdownButton = Backbone.$(self.options.buttonTemplate({
      buttonClass: self.options.buttonClass,
      buttonText: self.options.buttonText
    })).click(self.toggle);

    // Create dropdown container
    self.dropdownContainerView = new self.options.DropdownView({
      filterStateModel: self.filterStateModel,
      align: self.options.dropdownAlign,
      parentView: self
    }).render();

    // Render inner view
    document.body.appendChild(self.dropdownContainerView.el);
  },

  /**
   * @method setup
   */
  render: function () {
    var self = this;
    self.$el.empty();

    // Render button
    self.$el.html(self.$dropdownButton);

    // Verify disabled mode
    self.checkDisabled();

    return self;
  },

  /**
   * @method checkDisabled
   */
  checkDisabled: function() {
    var self = this;
    if (self.filterStateModel.get(&quot;filterCollection&quot;).length &gt; 0) {
      self.$dropdownButton.removeAttr(&quot;disabled&quot;);
    }
    else {
      self.$dropdownButton.attr(&quot;disabled&quot;, &quot;disabled&quot;);
    }
  },

  /**
   * Convenience function to stop event propagation
   *
   * @method stopPropagation
   * @param {object} e
   * @private
   */
  stopPropagation: function (e) {
    e.stopPropagation();
    e.stopImmediatePropagation();
    e.preventDefault();
  },

  /**
   * Toggle the dropdown visibility
   *
   * @method toggle
   * @param {object} [e]
   */
  toggle: function (e) {
    var self = this;
    if (self.isOpen !== true) {
      self.open(e);
    }
    else {
      self.close(e);
    }
  },

  /**
   * Open the dropdown
   *
   * @method open
   * @param {object} [e]
   */
  open: function (e) {
    var self = this;

    clearTimeout(self.closeTimeout);
    clearTimeout(self.deferCloseTimeout);

    if (e) {
      if (e.stopPropagation) {
        e.stopPropagation();
      }
      if (e.preventDefault) {
        e.preventDefault();
      }
      e.cancelBubble = true;
    }

    // Don&#x27;t do anything if already open
    if (self.isOpen) {
      return;
    }

    self.isOpen = true;
    self.$el.addClass(&quot;open&quot;);

    // Notify child view
    self.dropdownContainerView.open();
  },

  /**
   * Close the dropdown
   *
   * @method close
   * @param {object} [e]
   */
  close: function (e) {
    var self = this;

    // Don&#x27;t do anything if already closed
    if (!self.isOpen) {
      return;
    }

    self.isOpen = false;
    self.$el.removeClass(&quot;open&quot;);

    // Notify child view
    self.dropdownContainerView.close();
  },

  /**
   * Close the dropdown on esc
   *
   * @method closeOnEsc
   * @param {object} e
   * @private
   */
  closeOnEsc: function (e) {
    if (e.which === 27) {
      this.deferClose();
    }
  },

  /**
   * @method deferClose
   * @private
   */
  deferClose: function () {
    this.deferCloseTimeout = setTimeout(this.close, 0);
  },

  /**
   * @method stopDeferClose
   * @private
   */
  stopDeferClose: function (e) {
    clearTimeout(this.deferCloseTimeout);
  },

  /**
   * Clean up this control
   *
   * @method remove
   * @chainable
   */
  remove: function () {
    var self = this;

    // Remove child
    self.dropdownContainerView.remove();

    // Remove event listeners
    document.body.removeEventListener(&quot;click&quot;, self.deferClose);
    if (self.options.closeOnEsc) {
      document.body.removeEventListener(&quot;keyup&quot;, self.closeOnEsc);
    }
    self.$el.off(&quot;click&quot;, self.stopDeferClose);
    self.$dropdownButton.off(&quot;click&quot;, self.toggle);

    // Invoke original backbone methods
    return Backbone.View.prototype.remove.apply(self, arguments);
  }
});

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
