<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>/home/wilbert/github/backgrid-advanced-filter/src/filter-editor.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/AdvancedFilter.AttributeFilterCollection.html">AdvancedFilter.AttributeFilterCollection</a></li>
            
                <li><a href="../classes/AdvancedFilter.AttributeFilterModel.html">AdvancedFilter.AttributeFilterModel</a></li>
            
                <li><a href="../classes/AdvancedFilter.Editor.html">AdvancedFilter.Editor</a></li>
            
                <li><a href="../classes/AdvancedFilter.FilterCollection.html">AdvancedFilter.FilterCollection</a></li>
            
                <li><a href="../classes/AdvancedFilter.FilterModel.html">AdvancedFilter.FilterModel</a></li>
            
                <li><a href="../classes/AdvancedFilter.Main.html">AdvancedFilter.Main</a></li>
            
                <li><a href="../classes/AdvancedFilter.Saver.html">AdvancedFilter.Saver</a></li>
            
                <li><a href="../classes/AdvancedFilter.Selector.html">AdvancedFilter.Selector</a></li>
            
                <li><a href="../classes/AdvancedFilter.Subcomponents.FilterDropdown.html">AdvancedFilter.Subcomponents.FilterDropdown</a></li>
            
                <li><a href="../classes/AdvancedFilter.Subcomponents.FilterDropdownContainer.html">AdvancedFilter.Subcomponents.FilterDropdownContainer</a></li>
            
                <li><a href="../classes/AdvancedFilter.Subcomponents.FilterDropdownItemview.html">AdvancedFilter.Subcomponents.FilterDropdownItemview</a></li>
            
                <li><a href="../classes/AdvancedFilter.SubComponents.LabelView.html">AdvancedFilter.SubComponents.LabelView</a></li>
            
                <li><a href="../classes/FilterStateModel.html">FilterStateModel</a></li>
            
                <li><a href="../classes/NewFilterButtonView.html">NewFilterButtonView</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/AdvancedFilter.html">AdvancedFilter</a></li>
            
                <li><a href="../modules/AdvancedFilter.Editor.html">AdvancedFilter.Editor</a></li>
            
                <li><a href="../modules/AdvancedFilter.FilterCollection.html">AdvancedFilter.FilterCollection</a></li>
            
                <li><a href="../modules/AdvancedFilter.FilterStateModel.html">AdvancedFilter.FilterStateModel</a></li>
            
                <li><a href="../modules/AdvancedFilter.Saver.html">AdvancedFilter.Saver</a></li>
            
                <li><a href="../modules/AdvancedFilter.Selector.html">AdvancedFilter.Selector</a></li>
            
                <li><a href="../modules/AdvancedFilter.Subcomponents.html">AdvancedFilter.Subcomponents</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: /home/wilbert/github/backgrid-advanced-filter/src/filter-editor.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&quot;use strict&quot;;

/**
 * A column manager for backgrid
 *
 * @module AdvancedFilter.Editor
 */
var _ = require(&quot;underscore&quot;);
var $ = require(&quot;jquery&quot;);
var Backbone = require(&quot;backbone&quot;);
var Backgrid = require(&quot;backgrid&quot;);

/**
 * Matchers
 * @property matchers
 */
var matchers = {
  &quot;gt&quot;: {
    name: &quot;greater than&quot;
  },
  &quot;lt&quot;: {
    name: &quot;lower than&quot;
  },
  &quot;eq&quot;: {
    name: &quot;equals&quot;
  },
  &quot;neq&quot;: {
    name: &quot;does not equal&quot;
  },
  &quot;sw&quot;: {
    name: &quot;starts with&quot;
  },
  &quot;ew&quot;: {
    name: &quot;ends with&quot;
  },
  &quot;bt&quot;: {
    name: &quot;between&quot;
  }
};

/**
 * Types
 * @property types
 */
var types = {
  &quot;text&quot;: {
    validation: function(value) {
      return _.isString(value);
    },
    matchers: [&quot;sw&quot;, &quot;ew&quot;, &quot;eq&quot;, &quot;neq&quot;]
  },
  &quot;number&quot;: {
    parser: function(value) {
      return parseFloat(value);
    },
    validation: function(value) {
      return !isNaN(value);
    },
    matchers: [&quot;gt&quot;, &quot;lt&quot;, &quot;bt&quot;, &quot;eq&quot;, &quot;neq&quot;]
  },
  &quot;percent&quot;: {
    validation: function(value) {
      return !isNaN(value) &amp;&amp; value &gt;= 0 &amp;&amp; value &lt;= 100;
    },
    matchers: [&quot;gt&quot;, &quot;lt&quot;, &quot;bt&quot;, &quot;eq&quot;, &quot;neq&quot;]
  },
  &quot;boolean&quot;: {
    validation: function(value) {
      return _.isBoolean(value) || value === &quot;true&quot; || value === &quot;false&quot;;
    },
    matchers: [&quot;eq&quot;, &quot;neq&quot;]
  }
};

/**
 * @class NewFilterButtonView
 * @extends Backbone.View
 */
var NewFilterButtonView = Backbone.View.extend({
  template: _.template(&quot;&lt;button class=\&quot;new-attribute-filter\&quot;&gt;&lt;%-addFilterText%&gt;&lt;/button&gt;&quot;),
  defaults: {
    addFilterText: &quot;+&quot;
  },
  events: {
    &quot;click&quot;: &quot;newAttributeFilter&quot;
  },
  initialize: function(options) {
    var self = this;
    self.options = _.extend({}, self.defaults, options || {});

    // Input argument checking
    if (!self.options.filterStateModel ||
      !self.options.filterStateModel instanceof Backbone.Model) {
      throw new Error(&quot;No (valid) filter state model provided&quot;);
    }
    self.filterStateModel = self.options.filterStateModel;
  },
  render: function() {
    var self = this;
    self.$el.empty();

    self.$el.append(self.template({
      addFilterText: self.options.addFilterText
    }));

    return self;
  },

  newAttributeFilter: function(e) {
    var self = this;
    self.stopPropagation(e);

    // Get current filter
    var fsm = self.filterStateModel;
    var filterId = fsm.get(&quot;activeFilterId&quot;);
    var activeFilter = fsm.get(&quot;filterCollection&quot;).get(filterId);
    activeFilter.get(&quot;attributeFilters&quot;).createNewAttributeFilter();

    // Rerender
    self.render();
  },

  /**
   * Convenience function to stop event propagation
   *
   * @method stopPropagation
   * @param {object} e
   * @private
   */
  stopPropagation: function (e) {
    e.stopPropagation();
    e.stopImmediatePropagation();
    e.preventDefault();
  }
});

var RemoveFilterButtonView = Backbone.View.extend({
  template: _.template(&quot;&lt;button class=\&quot;remove-attribute-filter\&quot;&gt;&lt;%-removeFilterText%&gt;&lt;/button&gt;&quot;),
  defaults: {
    removeFilterText: &quot;-&quot;
  },
  events: {
    &quot;click&quot;: &quot;removeAttributeFilter&quot;
  },
  initialize: function(options) {
    var self = this;
    self.options = _.extend({}, self.defaults, options || {});

    // Input argument checking
    if (!self.options.filterStateModel ||
      !self.options.filterStateModel instanceof Backbone.Model) {
      throw new Error(&quot;No (valid) filter state model provided&quot;);
    }
    self.filterStateModel = self.options.filterStateModel;

    if (!self.options.filter ||
      !self.options.filter instanceof Backbone.Model) {
      throw new Error(&quot;No (valid) filter model provided&quot;);
    }
    self.filter = self.options.filter;
  },
  render: function() {
    var self = this;
    self.$el.empty();

    self.$el.append(self.template({
      removeFilterText: self.options.removeFilterText
    }));

    return self;
  },

  removeAttributeFilter: function(e) {
    var self = this;
    self.stopPropagation(e);

    // Get current filter
    var fsm = self.filterStateModel;
    var filterId = fsm.get(&quot;activeFilterId&quot;);
    var activeFilter = fsm.get(&quot;filterCollection&quot;).get(filterId);
    activeFilter.get(&quot;attributeFilters&quot;).remove(self.filter);

    // Rerender
    self.render();
  },

  /**
   * Convenience function to stop event propagation
   *
   * @method stopPropagation
   * @param {object} e
   * @private
   */
  stopPropagation: function (e) {
    e.stopPropagation();
    e.stopImmediatePropagation();
    e.preventDefault();
  }
});

var ColumnSelector = Backbone.View.extend({
  className: &quot;column-selector&quot;,
  tagName: &quot;select&quot;,
  events: {
    &quot;change&quot;: &quot;columnUpdate&quot;
  },

  render: function() {
    var self = this;
    self.$el.empty();

    // Add select options
    self.$el.append($(&quot;&lt;option&gt;&lt;/option&gt;&quot;)
      .attr(&quot;value&quot;, &quot;test&quot;)
      .text(&quot;test!&quot;));

    self.$el.append($(&quot;&lt;option&gt;&lt;/option&gt;&quot;)
      .attr(&quot;value&quot;, &quot;test2&quot;)
      .text(&quot;test2!&quot;));

    return self;
  },

  columnUpdate: function() {
    console.log(&quot;column change!&quot;);
  }
});

Backgrid.Extension.AdvancedFilter.SubComponents.FilterView = Backbone.View.extend({
  className: &quot;filter-editor&quot;,
  tagName: &quot;div&quot;,
  template: _.template(&quot;&quot; +
    &quot;&lt;div class=\&quot;filter-editor-column\&quot;&gt;&quot; +
    &quot;&lt;div class=\&quot;filter-editor-matcher\&quot;&gt;&quot; +
    &quot;&lt;div class=\&quot;filter-editor-value\&quot;&gt;&quot; +
    &quot;&lt;div class=\&quot;filter-editor-addremove\&quot;&gt;&quot; +
  &quot;&quot;),
  defaults: {
    ColumnSelectorView: ColumnSelector,
    NewFilterButtonView: NewFilterButtonView,
    RemoveFilterButtonView: RemoveFilterButtonView,
    matchers: matchers,
    types: types
  },

  initialize: function(options) {
    var self = this;
    self.options = _.extend({}, self.defaults, options || {});

    // Input argument checking
    if (!self.options.filterStateModel ||
      !self.options.filterStateModel instanceof Backbone.Model) {
      throw new Error(&quot;No (valid) filter state model provided&quot;);
    }
    self.filterStateModel = self.options.filterStateModel;

    if (!self.options.filter ||
      !self.options.filter instanceof Backbone.Model) {
      throw new Error(&quot;No (valid) filter state model provided&quot;);
    }
    self.filter = self.options.filter;

    // Events
    self.listenTo(self.filter, &quot;change:column change:type&quot;, self.render);
  },
  render: function() {
    var self = this;
    self.$el.empty();

    // Render template
    self.$el.append(self.template());

    // Add column selector
    var selectorView = new this.options.ColumnSelectorView();
    self.$el.find(&quot;.filter-editor-column&quot;).append(selectorView.render().$el);

    // Add attribute filter view
    var addAttributeFilterView = new this.options.NewFilterButtonView({
      filterStateModel: self.filterStateModel
    });
    self.$el.find(&quot;.filter-editor-addremove&quot;).append(addAttributeFilterView.render().$el);

    var removeAttributeFilterView = new this.options.RemoveFilterButtonView({
      filterStateModel: self.filterStateModel,
      filter: self.filter
    });
    self.$el.find(&quot;.filter-editor-addremove&quot;).append(removeAttributeFilterView.render().$el);

    return self;
  }

});

/**
 *
 * @class AdvancedFilter.Editor
 * @extends Backbone.View
 */
Backgrid.Extension.AdvancedFilter.Editor = Backbone.View.extend({
  className: &quot;advancedfilter-editor&quot;,
  tagName: &quot;div&quot;,
  defaults: {
    NewFilterButtonView: NewFilterButtonView
  },

  /**
   * @method initialize
   * @param options
   */
  initialize: function (options) {
    var self = this;
    self.options = _.extend({}, self.defaults, options || {});

    // Input argument checking
    if (!self.options.filterStateModel ||
      !self.options.filterStateModel instanceof Backbone.Model) {
      throw new Error(&quot;No (valid) filter state model provided&quot;);
    }
    self.filterStateModel = self.options.filterStateModel;

    self.listenTo(self.filterStateModel, &quot;change:activeFilterId&quot;, self.bindFilter);

    self.bindFilter();
  },

  bindFilter: function() {
    var self = this;

    // Get current filter
    var fsm = self.filterStateModel;
    var filterId = fsm.get(&quot;activeFilterId&quot;);

    // Unbind from previous filter if necessary
    if (self.activeFilter) {
      self.stopListening(self.activeFilter.get(&quot;attributeFilters&quot;));
    }

    if (filterId) {
      self.activeFilter = fsm.get(&quot;filterCollection&quot;).get(filterId);

      // Add event listener to attribute filter collection
      self.listenTo(self.activeFilter.get(&quot;attributeFilters&quot;), &quot;add remove&quot;, self.render);
    }
    else {
      self.activeFilter = null;
    }

    self.render();
  },

  /**
   * @method render
   * @return {AdvancedFilter.Editor}
   * @chainable
   */
  render: function() {
    var self = this;
    self.$el.empty();

    if (self.activeFilter) {
      var af = self.activeFilter;

      // Loop filters
      if (af.get(&quot;attributeFilters&quot;).length &gt; 0) {
        af.get(&quot;attributeFilters&quot;).each(function(filter) {
          var filterView = new Backgrid.Extension.AdvancedFilter.SubComponents.FilterView({
            filterStateModel: self.filterStateModel,
            filter: filter
          });

          self.$el.append(filterView.render().$el);
        });
      }
      else {
        // No filters available, render single &#x27;add filter&#x27; button
        var newFilterButtonView = new self.options.NewFilterButtonView({
          filterStateModel: self.filterStateModel
        });
        self.$el.append(newFilterButtonView.render().$el);
      }
    }

    return self;
  }
});

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
