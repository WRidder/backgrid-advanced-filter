<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>/home/wilbert/github/backgrid-advanced-filter/src/filter-collection.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/AdvancedFilter.AttributeFilterCollection.html">AdvancedFilter.AttributeFilterCollection</a></li>
            
                <li><a href="../classes/AdvancedFilter.AttributeFilterModel.html">AdvancedFilter.AttributeFilterModel</a></li>
            
                <li><a href="../classes/AdvancedFilter.Editor.html">AdvancedFilter.Editor</a></li>
            
                <li><a href="../classes/AdvancedFilter.FilterCollection.html">AdvancedFilter.FilterCollection</a></li>
            
                <li><a href="../classes/AdvancedFilter.FilterModel.html">AdvancedFilter.FilterModel</a></li>
            
                <li><a href="../classes/AdvancedFilter.Main.html">AdvancedFilter.Main</a></li>
            
                <li><a href="../classes/AdvancedFilter.Saver.html">AdvancedFilter.Saver</a></li>
            
                <li><a href="../classes/AdvancedFilter.Selector.html">AdvancedFilter.Selector</a></li>
            
                <li><a href="../classes/AdvancedFilter.Subcomponents.FilterDropdown.html">AdvancedFilter.Subcomponents.FilterDropdown</a></li>
            
                <li><a href="../classes/AdvancedFilter.Subcomponents.FilterDropdownContainer.html">AdvancedFilter.Subcomponents.FilterDropdownContainer</a></li>
            
                <li><a href="../classes/AdvancedFilter.Subcomponents.FilterDropdownItemview.html">AdvancedFilter.Subcomponents.FilterDropdownItemview</a></li>
            
                <li><a href="../classes/AdvancedFilter.SubComponents.LabelView.html">AdvancedFilter.SubComponents.LabelView</a></li>
            
                <li><a href="../classes/FilterStateModel.html">FilterStateModel</a></li>
            
                <li><a href="../classes/MongoParser.html">MongoParser</a></li>
            
                <li><a href="../classes/NewFilterButtonView.html">NewFilterButtonView</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/AdvancedFilter.html">AdvancedFilter</a></li>
            
                <li><a href="../modules/AdvancedFilter.Editor.html">AdvancedFilter.Editor</a></li>
            
                <li><a href="../modules/AdvancedFilter.FilterCollection.html">AdvancedFilter.FilterCollection</a></li>
            
                <li><a href="../modules/AdvancedFilter.FilterOptions.html">AdvancedFilter.FilterOptions</a></li>
            
                <li><a href="../modules/AdvancedFilter.FilterParsers.html">AdvancedFilter.FilterParsers</a></li>
            
                <li><a href="../modules/AdvancedFilter.FilterStateModel.html">AdvancedFilter.FilterStateModel</a></li>
            
                <li><a href="../modules/AdvancedFilter.Saver.html">AdvancedFilter.Saver</a></li>
            
                <li><a href="../modules/AdvancedFilter.Selector.html">AdvancedFilter.Selector</a></li>
            
                <li><a href="../modules/AdvancedFilter.Subcomponents.html">AdvancedFilter.Subcomponents</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: /home/wilbert/github/backgrid-advanced-filter/src/filter-collection.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&quot;use strict&quot;;

/**
 * Filter collection definition
 *
 * @module AdvancedFilter.FilterCollection
 */
var Backbone = require(&quot;backbone&quot;);
var Backgrid = require(&quot;backgrid&quot;);
var _ = require(&quot;underscore&quot;);

/**
 *
 * @class AdvancedFilter.AttributeFilterModel
 * @extends Backbone.Model
 */
var attributeFilterModel = Backgrid.Extension.AdvancedFilter.AttributeFilterModel = Backbone.Model.extend({
  defaults: {
    column: null,
    type: null,
    matcher: null,
    value: null,
    valid: false
  },

  initialize: function() {
    var self = this;

    // Events
    self.listenTo(self, &quot;change:column change:type change:matcher change:value&quot;, self.checkValidity);
  },

  checkValidity: function() {

  }
});

/**
 *
 * @class AdvancedFilter.AttributeFilterCollection
 * @extends Backbone.Collection
 */
Backgrid.Extension.AdvancedFilter.AttributeFilterCollection = Backbone.Collection.extend({
  model: attributeFilterModel,

  /**
   * @method createNewFilter
   */
  createNewAttributeFilter: function() {
    var self = this;

    self.add({});
  }
});

/**
 *
 * @class AdvancedFilter.FilterModel
 * @extends Backbone.Model
 */
var FilterModel = Backgrid.Extension.AdvancedFilter.FilterModel = Backbone.Model.extend({
  defaults: {
    name: null,
    attributeFilters: null
  },
  lastSavedState: null,
  filterChanged: false,

  /**
   * @method initialize
   */
  initialize: function() {
    var self = this;

    // Save the initial state so we can cancel changes later.
    self.saveState();

    // Update events
    self.listenTo(self.get(&quot;attributeFilters&quot;), &quot;change add remove&quot;, self.evtFilterChanged);
    self.listenTo(self, &quot;change:name&quot;, self.evtFilterChanged);
  },

  /**
   * @method evtFilterChanged
   */
  evtFilterChanged: function() {
    var self = this;
    self.filterChanged = true;

    self.trigger(&quot;filter:changed&quot;);
  },

  /**
   * @method saveFilter
   */
  saveFilter: function() {
    var self = this;
    self.saveState();
  },

  /**
   * @method resetFilter
   */
  resetFilter: function() {
    var self = this;
    self.get(&quot;attributeFilters&quot;).reset([]);
  },

  /**
   * @method cancelFilter
   */
  cancelFilter: function() {
    var self = this;
    self.loadSavedState();
  },

  /**
   * @method saveState
   * @private
   */
  saveState: function() {
    var self = this;

    var name = self.get(&quot;name&quot;);
    var attributeFilters = self.get(&quot;attributeFilters&quot;);

    if (attributeFilters &amp;&amp; attributeFilters.length &gt; 0) {
      attributeFilters = attributeFilters.toJSON();
    }
    else {
      attributeFilters = null;
    }

    self.lastSavedState = {
      name: name,
      attributeFilters: attributeFilters
    };

    self.filterChanged = false;
  },

  /**
   * @method loadSavedState
   * @private
   */
  loadSavedState: function() {
    var self = this;
    if (self.lastSavedState) {
      self.set(&quot;name&quot;, self.lastSavedState.name);
      self.get(&quot;attributeFilters&quot;).reset(self.lastSavedState.attributeFilters);
    }
  },

  /**
   * @method removeSavedState
   */
  removeSavedState: function() {
    var self = this;
    self.lastSavedState = null;
  },

  /**
   * Set override
   * Makes sure the attributeFilters are set as a collection.
   *
   * @method set
   * @param {Object} attributes
   * @param {Object} options
   * @return {*}
   */
  set: function(attributes, options) {
    var AttrCollection = Backgrid.Extension.AdvancedFilter.AttributeFilterCollection;
    if (attributes.attributeFilters !== undefined &amp;&amp;
      !(attributes.attributeFilters instanceof AttrCollection)) {
      attributes.attributeFilters = new AttrCollection(attributes.attributeFilters);
    }
    return Backbone.Model.prototype.set.call(this, attributes, options);
  }
});

/**
 *
 * @class AdvancedFilter.FilterCollection
 * @extends Backbone.Collection
 */
Backgrid.Extension.AdvancedFilter.FilterCollection = Backbone.Collection.extend({
  /**
   * Partial in newFilterName which is replaced by a number.
   * @property filterNamePartial
   */
  filterNamePartial: &quot;{count}&quot;,

  /**
   *  Template for new filter names. Beware: partial should be located at the end!
   *  @property newFilterName
   */
  newFilterName: &quot;New Filter #{count}&quot;,
  newFilterCount: 0,
  model: FilterModel,

  /**
   * @method createNewFilter
   * @return {Backbone.Model} newFilter
   */
  createNewFilter: function() {
    var self = this;

    var newFilter = new FilterModel({
      name: self.getNewFilterName(self.getNewFilterNumber())
    });

    // Add to the collection
    self.add(newFilter);

    // Return the filter
    return newFilter;
  },

  /**
   * Retrieves a new filter number.
   * @method getNewFilterNumber
   * @return {int}
   * @private
   */
  getNewFilterNumber: function() {
    var self = this;
    self.newFilterCount += 1;

    if (self.length === 0) {
      return self.newFilterCount;
    }
    else {
      var newFilterName = self.newFilterName.replace(self.filterNamePartial, &quot;&quot;);
      var results = self.filter(function(fm) {
        return fm.get(&quot;name&quot;).indexOf(newFilterName) === 0;
      }).map(function(fm) {
        return fm.get(&quot;name&quot;);
      });

      if (_.isArray(results) &amp;&amp; results.length &gt; 0) {
        // Sort results
        results.sort();

        // Get highest count
        var highestCount = parseInt(results[results.length - 1].replace(newFilterName, &quot;&quot;));
        if (_.isNaN(highestCount)) {
          highestCount = self.newFilterCount;
        }
        else {
          highestCount += 1;
        }
      }
      else {
        highestCount = self.newFilterCount;
      }

      return highestCount;
    }
  },

  /**
   *
   * @method getNewFilterName
   * @param {int} count
   * @return {string}
   * @private
   */
  getNewFilterName: function(count) {
    return this.newFilterName.replace(this.filterNamePartial, count);
  }
});

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
